
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SVD (Singular Value Decomposition) &#8212; AI primer</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'SVD';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RF (Random Forest)" href="RF.html" />
    <link rel="prev" title="Welcome to AI primer course" href="README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
  
    <p class="title logo__title">AI primer</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Welcome to AI primer course
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SVD (Singular Value Decomposition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RF.html">RF (Random Forest)</a></li>
<li class="toctree-l1"><a class="reference internal" href="DNN.html">DNN (Deep Neural Networks)</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN.html">CNN (Convolutional Neural Networks)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Attention.html">Attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namesformer.html">Namesformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Varia.html">Varia</a></li>
<li class="toctree-l1"><a class="reference internal" href="TD.html">Bonus: TD (Temporal Difference)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RL.html">Bonus: Reinforcement Learning</a></li>




<li class="toctree-l1"><a class="reference internal" href="Project.html">Project: Flatland</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/trokas/ai_primer/blob/master/SVD.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/SVD.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SVD (Singular Value Decomposition)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#increasing-importance-of-linear-algebra">Increasing importance of linear algebra</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-algebra-missing-pieces">Linear algebra (missing pieces?)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-vector-multiplication">Matrix-vector multiplication</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eigenvectors">Eigenvectors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-calculate-eigenvectors">How to calculate eigenvectors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#singular-value-decomposition-svd">Singular Value Decomposition (SVD)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-is-svd-computed">How is SVD computed?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-svd-to-compress-images">Using SVD to compress images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svd-for-linear-regression">SVD for linear regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-principal-component-analysis">PCA (Principal Component analysis)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommender-using-svd">Recommender using SVD</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplest-recommender">Simplest recommender</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#movielense-dataset">MovieLense dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-svd-implementation">Naive SVD implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-sources">(re)Sources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="svd-singular-value-decomposition">
<h1>SVD (Singular Value Decomposition)<a class="headerlink" href="#svd-singular-value-decomposition" title="Link to this heading">#</a></h1>
<p>What we will cover in this page:</p>
<ul class="simple">
<li><p>Increasing importance of linear algebra</p></li>
<li><p>Singular Value Decomposition (SVD)</p></li>
<li><p>Using SVD to compress images</p></li>
<li><p>Recommender using SVD</p></li>
<li><p>SVD for linear regression</p></li>
<li><p>Naive SVD algorithm</p></li>
</ul>
<section id="increasing-importance-of-linear-algebra">
<h2>Increasing importance of linear algebra<a class="headerlink" href="#increasing-importance-of-linear-algebra" title="Link to this heading">#</a></h2>
<p>In 1844 Hermann Grassmann published his “Theory of Extension” which included foundational new topics of what is today called <strong>linear algebra</strong>. In 1848, James Joseph Sylvester introduced the term <strong>matrix</strong>, which is Latin for womb.
Linear algebra is the branch of mathematics concerning linear equations such as
$a_{1}x_{1}+\cdots +a_{n}x_{n}=b$ and linear functions such as $(x_{1},\ldots ,x_{n})\mapsto a_{1}x_{1}+\ldots +a_{n}x_{n}$
and their representations through <strong>matrices and vector spaces</strong>. Linear algebra is increasing in importance as a core tool in the AI field. Nice <a class="reference external" href="https://lexfridman.com/gilbert-strang/">podcast</a> about this increasing importance, Strang even suggests to replace calculus by linear algebra in schools. By the way most calculus operations have discrete analogues in linear algebra.</p>
<section id="linear-algebra-missing-pieces">
<h3>Linear algebra (missing pieces?)<a class="headerlink" href="#linear-algebra-missing-pieces" title="Link to this heading">#</a></h3>
<p>Since you know linear algebra well I just want to point out some important things which often are left forgotten:</p>
<ul class="simple">
<li><p>Algebra has geometric interpretation</p></li>
<li><p>Usually you can think about algebraic objects and operations in alternative ways and that can open up some doors</p></li>
</ul>
<p>Here are a couple examples to prove these points and give you some intuition.</p>
<section id="matrix-vector-multiplication">
<h4>Matrix-vector multiplication<a class="headerlink" href="#matrix-vector-multiplication" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Matrix is a collection of vectors</p></li>
<li><p>A matrix maps one vector to another vector</p></li>
<li><p>Matrix times vector can be thought of as a weighted sum of matrix columns</p></li>
</ul>
<img src="https://eli.thegreenplace.net/images/2015/veccomb.png" alt="Matrix times vector" style="width: 50%"/>
<img src="https://eli.thegreenplace.net/images/2015/vecrowcomb.png" alt="Vector times matrix" style="width: 50%"/>
<p>So if we multiply a space by a matrix it enables us to <strong>stretch and rotate</strong> original space.</p>
<img src="https://i.ytimg.com/vi/XkY2DOUCWMU/maxresdefault.jpg" alt="Space deformation" style="width: 50%"/>
<p>For example</p>
<p>$$
\begin{bmatrix}
\cos(\theta) &amp; -\sin(\theta)\
\sin(\theta) &amp; \cos(\theta)
\end{bmatrix}
$$</p>
<p>works as a simple counter-clockwise rotation, and it’s inverse as clockwise rotation. For more geometric interpretations see <strong>3Blue1Brown</strong> <a class="reference external" href="https://www.youtube.com/watch?v=kjBOesZCoqc&amp;amp;feature=emb_title">linear algebra</a> course.</p>
</section>
</section>
<section id="eigenvectors">
<h3>Eigenvectors<a class="headerlink" href="#eigenvectors" title="Link to this heading">#</a></h3>
<p><strong>Suggested reading:</strong> <a class="reference external" href="https://www.math.arizona.edu/~glickenstein/math443f08/bryanleise.pdf">THE $25,000,000,000 EIGENVECTOR THE LINEAR ALGEBRA BEHIND GOOGLE</a></p>
<p>So if a vector multiplied by a matrix is a stretch and rotation, then axes of rotation can be especially useful. These axes are called eigenvectors and are easy to define, we just formalize the fact that rotation does nothing by $A u=\lambda u$, where $\lambda$ is a scalar (eigenvalue).</p>
<p>An eigenvector (eigen means ‘specific’ in German) is a vector whose direction remains unchanged when a linear transformation is applied to it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]])</span>

<span class="n">values</span><span class="p">,</span> <span class="n">vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Eigenvalues:</span><span class="se">\n</span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="se">\n</span><span class="s1">Eigenvectors:</span><span class="se">\n</span><span class="si">{</span><span class="n">vectors</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Eigenvalues:
[-1. -2.]
Eigenvectors:
[[ 1.         -0.70710678]
 [ 0.          0.70710678]]
</pre></div>
</div>
</div>
</div>
<p>Let’s see what’s going on here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">U_proj</span><span class="p">,</span> <span class="n">V_proj</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U_proj</span><span class="p">,</span> <span class="n">V_proj</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3fd62ca24587d0782285f0118fb167c089b86a3992c6a19ef9e0ef9584098d85.png" src="_images/3fd62ca24587d0782285f0118fb167c089b86a3992c6a19ef9e0ef9584098d85.png" />
</div>
</div>
<p><strong>TASK:</strong> play a bit and make sure that it works as expected and you can use basic <em>numpy</em> functions easily (for example <em>np.dot</em>), we will need it a lot in the future.</p>
<p><strong>TASK:</strong> play with a matrix
$\begin{bmatrix}
3 &amp; 1\
1 &amp; 2
\end{bmatrix}$,
can you tell what it does to the vector space and where eigenvectors are located? Do they have a clear interpretation?</p>
<p>Some of the things you might discover will work only for symmetric matrices (those which are equal to its own transpose). Keep that in mind, later we will intentionally produce symmetric matrices.</p>
</section>
<section id="how-to-calculate-eigenvectors">
<h3>How to calculate eigenvectors<a class="headerlink" href="#how-to-calculate-eigenvectors" title="Link to this heading">#</a></h3>
<p>You might know that already, but let’s run through a quick example to get some intuition. Let</p>
<p>$$A = \begin{bmatrix}
2 &amp; 3\
2 &amp; 1
\end{bmatrix}$$</p>
<p>Since we are solving for $A u=\lambda u$ it is the same as to request that $A - \lambda I = 0$ or</p>
<p>$$\det\begin{pmatrix}
2 - \lambda &amp; 3\
2 &amp; 1 - \lambda
\end{pmatrix} = 0.$$</p>
<p>After solving it you end up with two eigenvalues $\lambda_1 = -1$ and $\lambda_2 = 4$. The eigenvalue specifies the size of the eigenvector, let’s find those now. By solving system of equations defined by $Au_1 = -u_1$ you should get $u_1 = \begin{bmatrix}-1\1\end{bmatrix}$ and $Au_2 = 4u_2$ quickly leads to $u_2 = \begin{bmatrix}3\2\end{bmatrix}$.</p>
<p><strong>TASK:</strong> confirm these calculations using numpy.</p>
</section>
<section id="singular-value-decomposition-svd">
<h3>Singular Value Decomposition (SVD)<a class="headerlink" href="#singular-value-decomposition-svd" title="Link to this heading">#</a></h3>
<p>We can decompose matrix any way we like, for example: $A = B + C$, $A = B \cdot C$, … It turns out that some decompositions are useful for data compression, numerical calculations and might reveal insights into the data. SVD is defined as:</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Singular_value_decomposition_visualisation.svg/220px-Singular_value_decomposition_visualisation.svg.png" alt="SVD" style="width: 40%"/>
<p>For some motivation see this <a class="reference external" href="https://www.youtube.com/watch?v=YPe5OP7Clv4">video</a> with Gilbert Strang.</p>
<p>It is not really clear who invented SVD, but it’s clear that it happened in the 19th century. For early history see this <a class="reference external" href="https://www.math.ucdavis.edu/~saito/courses/229A/stewart-svd.pdf">paper</a>. Fun fact: Gauss used matrix decomposition in 1823.</p>
<p>SVD is widely used in:</p>
<ul class="simple">
<li><p>Data compression</p></li>
<li><p>Recommender systems</p></li>
<li><p>Linear regressions</p></li>
<li><p>NLP (natural language processing)</p></li>
<li><p>PCA (principal component analysis)</p></li>
</ul>
<p>We will see some examples below starting from data compression.</p>
<section id="how-is-svd-computed">
<h4>How is SVD computed?<a class="headerlink" href="#how-is-svd-computed" title="Link to this heading">#</a></h4>
<p>Let’s compute SVD for</p>
<p>$X=
\begin{bmatrix}
5 &amp; 5\
-1 &amp; 7
\end{bmatrix} = USV^T.$</p>
<p>We start by producing symmetric matrix (you should have some intuition why we need that by now)</p>
<p>$$X^T X=VS^TSV^T=
\begin{bmatrix}
26 &amp; 18\
18 &amp; 74
\end{bmatrix} = USV^T.$$</p>
<p>Now we can compute eigenvectors using determinant. Since
$\det(X^TX - \lambda I) = (\lambda - 20)(\lambda - 80)$
we have</p>
<p>$$X^TX - 80 I =
\begin{bmatrix}
-54 &amp; 18\
18 &amp; -6
\end{bmatrix}
\rightarrow
V_1 = \frac{1}{\sqrt{10}}
\begin{bmatrix}
1\
3
\end{bmatrix}.$$</p>
<p>$$X^TX - 20 I =
\begin{bmatrix}
6 &amp; 18\
18 &amp; 54
\end{bmatrix}
\rightarrow
V_2 = \frac{1}{\sqrt{10}}
\begin{bmatrix}
3\
-1
\end{bmatrix};$$</p>
<p>Now we have</p>
<p>$$V = \frac{1}{\sqrt{10}}
\begin{bmatrix}
1 &amp; 3\
3 &amp; -1
\end{bmatrix},$$</p>
<p>thus knowing that $XV=US$ it is easy to find</p>
<p>$$S =
\begin{bmatrix}
4\sqrt{5} &amp; 0\
0 &amp; 2\sqrt{5}
\end{bmatrix};;
U = \frac{1}{\sqrt{2}}
\begin{bmatrix}
1 &amp; 1\
1 &amp; -1
\end{bmatrix}.$$</p>
<p>Let’s confirm our results using numpy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
              <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>

<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;U</span><span class="se">\n</span><span class="si">{</span><span class="n">U</span><span class="si">}</span><span class="se">\n</span><span class="s1">S</span><span class="se">\n</span><span class="si">{</span><span class="n">S</span><span class="si">}</span><span class="se">\n</span><span class="s1">V</span><span class="se">\n</span><span class="si">{</span><span class="n">V</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>U
[[ 0.70710678  0.70710678]
 [ 0.70710678 -0.70710678]]
S
[8.94427191 4.47213595]
V
[[ 0.31622777  0.9486833 ]
 [ 0.9486833  -0.31622777]]
</pre></div>
</div>
</div>
</div>
<p>And to get back the original matrix we can do</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">U</span> <span class="o">*</span> <span class="n">S</span><span class="p">)</span> <span class="o">@</span> <span class="n">V</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 5.,  5.],
       [-1.,  7.]])
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> there is no need to add transpose for V since <code class="docutils literal notranslate"><span class="pre">np.linalg.svd</span></code> already returns transposed matrix. You can confirm this by typing in <code class="docutils literal notranslate"><span class="pre">np.linalg.svd?</span></code> and reading provided docs.</p>
</section>
</section>
</section>
<section id="using-svd-to-compress-images">
<h2>Using SVD to compress images<a class="headerlink" href="#using-svd-to-compress-images" title="Link to this heading">#</a></h2>
<p>We will use the following trick to compress images:</p>
<ul class="simple">
<li><p>Calculate SVD of an image</p></li>
<li><p>Leave only top N factors in S</p></li>
<li><p>Multiply matrices to obtain compressed image</p></li>
</ul>
<img src="https://image1.slideserve.com/2598122/svd-and-rank-k-approximations-l.jpg" alt="Rank-k approximation" style="width: 50%"/>
<p>As we saw this should work, because S captures most relevant eigenvectors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Just a little helper function to get a nice image plot&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">255</span> <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>https://raw.githubusercontent.com/trokas/ai_primer/master/img/flud.jpg<span class="w"> </span>--output<span class="w"> </span>flud.jpg
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  103k  100  103k    0     0   218k      0 --:--:-- --:--:-- --:--:--  219k
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;flud.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image shape </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image shape (503, 800)
</pre></div>
</div>
<img alt="_images/adaf656e5902a989222f91ba9f953ae65a9971bbaff4f92c77259fee59065143.png" src="_images/adaf656e5902a989222f91ba9f953ae65a9971bbaff4f92c77259fee59065143.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate number of values in SVD&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>First, let’s use all singular values. Even then we reach some compression!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;U shape - </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">S shape - </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">V shape - </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">plot</span><span class="p">((</span><span class="n">U</span> <span class="o">*</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Compression rate with all singular values - </span><span class="si">{0:.02%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="mi">1</span> <span class="o">-</span> <span class="n">size</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)])</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>U shape - (503, 503)
S shape - (503,)
V shape - (800, 800)
</pre></div>
</div>
<img alt="_images/8f0611d7860da6ecceb0631c706ea0d88ea101aac5e6e96fbe0011d978a94f65.png" src="_images/8f0611d7860da6ecceb0631c706ea0d88ea101aac5e6e96fbe0011d978a94f65.png" />
</div>
</div>
<p><strong>TASK:</strong> check if all values of <code class="docutils literal notranslate"><span class="pre">(U</span> <span class="pre">*</span> <span class="pre">S).dot(V[:len(S)])</span></code> match <code class="docutils literal notranslate"><span class="pre">X</span></code> using numpy.</p>
<p>Let’s try to use only top singular values thus compressing the image even more.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,:</span><span class="n">i</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">V</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
    <span class="n">plot</span><span class="p">((</span><span class="n">u</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Using </span><span class="si">{0}</span><span class="s1"> singular values, compression rate = </span><span class="si">{1:.02%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">i</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/75cc89f25d98aaad74da8b99f53f381b587eda6780af73d064749d24c22f4c29.png" src="_images/75cc89f25d98aaad74da8b99f53f381b587eda6780af73d064749d24c22f4c29.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<p>Note, that first singular values capture most of the information and thus lead to high compression rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Singular values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/47525fc9f86d397bc246cba56ac339365ce8d775078d04c47c2aa2c327ccf2a6.png" src="_images/47525fc9f86d397bc246cba56ac339365ce8d775078d04c47c2aa2c327ccf2a6.png" />
</div>
</div>
<p><strong>TASK:</strong> play with animation and explore U, S, V, how many numbers do you need to transmit comprehensible image?</p>
</section>
<section id="svd-for-linear-regression">
<h2>SVD for linear regression<a class="headerlink" href="#svd-for-linear-regression" title="Link to this heading">#</a></h2>
<p>As you might know inverses are computationally unstable, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">hilbert</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">hilbert</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For sure we expect $(X^{-1})^{-1} = X$, but</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Errors obtained by $(X^{-1})^{-1} - X$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02d6b0fa41e62ea61d20d2f2da2f1e5ea5dc92a94b75c4ab55166b18fb6aff7e.png" src="_images/02d6b0fa41e62ea61d20d2f2da2f1e5ea5dc92a94b75c4ab55166b18fb6aff7e.png" />
</div>
</div>
<p>Further computations might lead to even higher errors, for example we would expect $X^{-1} X v = v$.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.00046553 -0.0022208   0.0002307   0.0115333  -0.02372203  0.02033834
 -0.00750237  0.00029245  0.00066456 -0.00013716]
</pre></div>
</div>
</div>
</div>
<p>Linear regression works by</p>
<p>$$y=X\hat\beta$$</p>
<p>$$X^Ty=X^TX\hat\beta$$</p>
<p>$$\hat \beta = (X^T X)^{-1} X^T y$$</p>
<p>By the way you can vizualize linear regression as the process of minimizing $e$ in</p>
<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQXvIwYtFpyuHEa_0zYoECXKp3JRdf6Q89eo3Prpw9SvJBJoLmC" alt="Linear regression" style="width: 40%"/>
<p>thus it’s an analogue of finding a projection of the target vector in a given vector space.</p>
<p>Let’s come back to our problem - we saw that the inverse is unstable… SVD is one of the solutions to deal with that problem.</p>
<p>Since $X=USV^T$ and $UU^T=I_m;;VV^T=I_n$ it is easy to show that $\hat \beta = (X^T X)^{-1} X^T y = V S^{-1} U^T y.$</p>
<p><strong>Note:</strong> the inverse of S is known to be stable.</p>
<p>Let’s see if this trick really works on a real dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_diabetes</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span><span class="o">.</span><span class="n">target</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># add ones to dataset </span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">X</span><span class="p">])</span>
<span class="c1"># calculate beta using direct inverse</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(442, 10) (442,)
</pre></div>
</div>
</div>
</div>
<p>Calculate beta using direct inverse</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE = 2859.6903987680657
</pre></div>
</div>
</div>
</div>
<p>Calculate using SVD</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)))])</span><span class="o">.</span><span class="n">T</span>    <span class="c1"># X ~ U.dot(S).dot(V)</span>
<span class="n">beta_svd</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta_svd</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE = 2859.6903987680657
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> sklearn and most other libraries use SVD for regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>   <span class="c1"># we do not need to add 1&#39;s column now</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE = 2859.6903987680657
</pre></div>
</div>
</div>
</div>
<p><strong>TASK:</strong> look at the diabetes dataset, can you beat current result by some simple feature engineering? Or maybe we do not need all of the features?</p>
<section id="pca-principal-component-analysis">
<h3>PCA (Principal Component analysis)<a class="headerlink" href="#pca-principal-component-analysis" title="Link to this heading">#</a></h3>
<p>Similarly as with images SVD can be used to reveal most important components of the given dataset and thus lead to data compression. The process is called Principal Component analysis (PCA) as is executed as follows:</p>
<ol class="arabic simple">
<li><p>Make sure that your dataset has samples in rows and variables in columns.</p></li>
<li><p>Subtract mean and divide by standard deviation to normalize each variable to get $X$. To be fair subtracting mean is sufficient, but working with standard scaling is a good practice.</p></li>
<li><p>Calculate SVD by computing $X=USV^T$.</p></li>
<li><p>Treat $V$ are principal directions/axes and $US$ are principal components/scores.</p></li>
</ol>
<p><strong>NOTE:</strong> make sure that you can explain why each step is needed. If you need more explanation, read through this <a class="reference external" href="https://stats.stackexchange.com/questions/134282/relationship-between-svd-and-pca-how-to-use-svd-to-perform-pca">discussion</a>, it contains some good links too.</p>
<p>This is a neat trick if we want to apply simple model (for example linear regression) on high dimensional datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># this is called Standard Scaling</span>
<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">U</span><span class="p">[:,:</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>    <span class="c1"># principal components</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-0.58720767, -1.94682793,  0.58923299, -0.0828117 ],
       [ 2.83161209,  1.37208454,  0.02791506, -0.46999935],
       [-0.27214757, -1.63489803,  0.73927034, -0.79147497],
       ...,
       [ 0.20524634, -1.20544647,  0.4960784 , -1.35334928],
       [-0.69286627,  0.21011694, -0.86872976,  1.61678966],
       [ 1.90393365,  3.97577106, -0.04838108, -0.22061154]])
</pre></div>
</div>
</div>
</div>
<p>Just to confirm that we interpreted SVD correctly this is sklearn implementation of PCA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.58720767, -1.94682793,  0.58923299, -0.0828117 ],
       [-2.83161209,  1.37208454,  0.02791506, -0.46999935],
       [ 0.27214757, -1.63489803,  0.73927034, -0.79147497],
       ...,
       [-0.20524634, -1.20544647,  0.4960784 , -1.35334928],
       [ 0.69286627,  0.21011694, -0.86872976,  1.61678966],
       [-1.90393365,  3.97577106, -0.04838108, -0.22061154]])
</pre></div>
</div>
</div>
</div>
<p>For our simple dataset PCA does not help to improve RMSE, but keep this in your toolbox for those case where you have high number of correlated features. Also it can be used to plot high dimensional datasets by projecting them to lower dimension. Let’s take a look.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_proj</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_proj</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_proj</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;First two principal components colored by price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fb77095375b5157be196383f236dd11a2c77b95343b9aa1a9aa935b6ffb7c069.png" src="_images/fb77095375b5157be196383f236dd11a2c77b95343b9aa1a9aa935b6ffb7c069.png" />
</div>
</div>
<p><strong>TASK:</strong> PCA can be used as anomaly detection simply by looking at the reconstruction error. Try to test this out using Olivetti faces dataset (<code class="docutils literal notranslate"><span class="pre">sklearn.datasets.fetch_olivetti_faces</span></code>). Just flip one or couple of images upside down so that they would look like anomalies, then encode and decode using PCA.</p>
<p><strong>TASK:</strong> Make sure that you can repeat same exercise using SVD directly. Convince yourself that the last line of the code creates inverse transform.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">avg_face</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># Average face</span>

<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">avg_face</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>   <span class="c1"># We transpose so that image spans a column</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">20</span>                    <span class="c1"># Number of components</span>
<span class="n">face_to_encode</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     <span class="c1"># You can take any image here (for example: try to flip it using X[0][::-1])</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">face_to_encode</span> <span class="o">-</span> <span class="n">avg_face</span><span class="p">)</span>      <span class="c1"># Here we encode image from 64x64 to only 20 values!</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">avg_face</span> <span class="o">+</span> <span class="n">U</span><span class="p">[:,:</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">encoded</span>     <span class="c1"># This should be similar to face_to_encode</span>
</pre></div>
</div>
<p>In essence we create a base of images in U that are used for encoding and decoding. If you take high number of components <code class="docutils literal notranslate"><span class="pre">U[:,:i]</span> <span class="pre">&#64;</span> <span class="pre">U[:,:i].T</span></code> will get close to identity, but when number of components is small it preserves only most relevant info. This is similar to Fourier transform, just that the base to use is suggested by the data. By the way, if you have big datasets you might need to use <code class="docutils literal notranslate"><span class="pre">sklearn.utils.extmath.randomized_svd</span></code> instead of <code class="docutils literal notranslate"><span class="pre">np.linalg.svd</span></code> to get decent run times.</p>
<p><strong>TASK:</strong> Download the extended Yale faces dataset using the code provided below. Take the first face and leave it aside for testing (don’t show it for the encoder while fitting it). Use PCA (or randomized SVD) and fit provided data. Check how it works on the image you have set aside. How many components do you need to get a decent reconstruction? Now comes the fun part - download <a class="reference external" href="https://raw.githubusercontent.com/trokas/ai_primer/master/img/dog_crop.jpg">cropped dog</a> and <a class="reference external" href="https://raw.githubusercontent.com/trokas/ai_primer/master/img/dog_full.jpg">full dog</a> images and try to encode and decode them using a different number of components. Which of those is easier to reconstruct? How many components do you need?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">trokas</span><span class="o">/</span><span class="n">ai_primer</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">img</span><span class="o">/</span><span class="n">CroppedYale</span><span class="o">.</span><span class="n">zip</span> <span class="o">--</span><span class="n">output</span> <span class="n">CroppedYale</span><span class="o">.</span><span class="n">zip</span>
<span class="err">!</span><span class="n">unzip</span> <span class="n">CroppedYale</span><span class="o">.</span><span class="n">zip</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;CroppedYale/*/*E*.pgm&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>Originally dataset was hosted on http://vision.ucsd.edu/extyaleb/CroppedYaleBZip/CroppedYale.zip.</p>
<hr class="docutils" />
<p><strong>Solution (to the last TASK)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.extmath</span> <span class="kn">import</span> <span class="n">randomized_svd</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;CroppedYale/*/*E*.pgm&#39;</span><span class="p">)])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2414</span><span class="p">,</span> <span class="mi">192</span> <span class="o">*</span> <span class="mi">168</span><span class="p">))</span>

<span class="n">avg_face</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>     <span class="c1"># Average face</span>
<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">randomized_svd</span><span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">avg_face</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">600</span>  <span class="c1"># play with number of values</span>
<span class="n">dog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;dog_crop.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">))</span>   <span class="c1"># try to change to dog_full.jpg</span>

<span class="n">face_to_encode</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">:</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">face_to_encode</span> <span class="o">-</span> <span class="n">avg_face</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">avg_face</span> <span class="o">+</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">:</span><span class="n">k</span><span class="p">]</span> <span class="o">@</span> <span class="n">encoded</span>

<span class="n">plot</span><span class="p">(</span><span class="n">face_to_encode</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">168</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plot</span><span class="p">(</span><span class="n">decoded</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">168</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="recommender-using-svd">
<h2>Recommender using SVD<a class="headerlink" href="#recommender-using-svd" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;Alien&#39;</span><span class="p">,</span> <span class="s1">&#39;Serenity&#39;</span><span class="p">,</span> <span class="s1">&#39;Casablanca&#39;</span><span class="p">,</span> <span class="s1">&#39;Amelie&#39;</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_6f425_row0_col0, #T_6f425_row0_col1, #T_6f425_row0_col2 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_6f425_row0_col3, #T_6f425_row0_col4, #T_6f425_row1_col3, #T_6f425_row1_col4, #T_6f425_row2_col3, #T_6f425_row2_col4, #T_6f425_row3_col3, #T_6f425_row3_col4, #T_6f425_row4_col0, #T_6f425_row4_col1, #T_6f425_row4_col2, #T_6f425_row5_col0, #T_6f425_row5_col1, #T_6f425_row5_col2, #T_6f425_row6_col0, #T_6f425_row6_col1, #T_6f425_row6_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_6f425_row1_col0, #T_6f425_row1_col1, #T_6f425_row1_col2 {
  background-color: #4295c3;
  color: #f1f1f1;
}
#T_6f425_row2_col0, #T_6f425_row2_col1, #T_6f425_row2_col2, #T_6f425_row4_col3, #T_6f425_row4_col4 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_6f425_row3_col0, #T_6f425_row3_col1, #T_6f425_row3_col2, #T_6f425_row5_col3, #T_6f425_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_6f425_row6_col3, #T_6f425_row6_col4 {
  background-color: #9cb9d9;
  color: #000000;
}
</style>
<table id="T_6f425_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >Matrix</th>
      <th class="col_heading level0 col1" >Alien</th>
      <th class="col_heading level0 col2" >Serenity</th>
      <th class="col_heading level0 col3" >Casablanca</th>
      <th class="col_heading level0 col4" >Amelie</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_6f425_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_6f425_row0_col0" class="data row0 col0" >1.00</td>
      <td id="T_6f425_row0_col1" class="data row0 col1" >1.00</td>
      <td id="T_6f425_row0_col2" class="data row0 col2" >1.00</td>
      <td id="T_6f425_row0_col3" class="data row0 col3" >0.00</td>
      <td id="T_6f425_row0_col4" class="data row0 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6f425_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_6f425_row1_col0" class="data row1 col0" >3.00</td>
      <td id="T_6f425_row1_col1" class="data row1 col1" >3.00</td>
      <td id="T_6f425_row1_col2" class="data row1 col2" >3.00</td>
      <td id="T_6f425_row1_col3" class="data row1 col3" >0.00</td>
      <td id="T_6f425_row1_col4" class="data row1 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6f425_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_6f425_row2_col0" class="data row2 col0" >4.00</td>
      <td id="T_6f425_row2_col1" class="data row2 col1" >4.00</td>
      <td id="T_6f425_row2_col2" class="data row2 col2" >4.00</td>
      <td id="T_6f425_row2_col3" class="data row2 col3" >0.00</td>
      <td id="T_6f425_row2_col4" class="data row2 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6f425_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_6f425_row3_col0" class="data row3 col0" >5.00</td>
      <td id="T_6f425_row3_col1" class="data row3 col1" >5.00</td>
      <td id="T_6f425_row3_col2" class="data row3 col2" >5.00</td>
      <td id="T_6f425_row3_col3" class="data row3 col3" >0.00</td>
      <td id="T_6f425_row3_col4" class="data row3 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6f425_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_6f425_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_6f425_row4_col1" class="data row4 col1" >0.00</td>
      <td id="T_6f425_row4_col2" class="data row4 col2" >0.00</td>
      <td id="T_6f425_row4_col3" class="data row4 col3" >4.00</td>
      <td id="T_6f425_row4_col4" class="data row4 col4" >4.00</td>
    </tr>
    <tr>
      <th id="T_6f425_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_6f425_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_6f425_row5_col1" class="data row5 col1" >0.00</td>
      <td id="T_6f425_row5_col2" class="data row5 col2" >0.00</td>
      <td id="T_6f425_row5_col3" class="data row5 col3" >5.00</td>
      <td id="T_6f425_row5_col4" class="data row5 col4" >5.00</td>
    </tr>
    <tr>
      <th id="T_6f425_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_6f425_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_6f425_row6_col1" class="data row6 col1" >0.00</td>
      <td id="T_6f425_row6_col2" class="data row6 col2" >0.00</td>
      <td id="T_6f425_row6_col3" class="data row6 col3" >2.00</td>
      <td id="T_6f425_row6_col4" class="data row6 col4" >2.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_bbe0a_row0_col0 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_bbe0a_row0_col1, #T_bbe0a_row0_col3, #T_bbe0a_row1_col1, #T_bbe0a_row2_col1, #T_bbe0a_row2_col2, #T_bbe0a_row3_col1, #T_bbe0a_row3_col2, #T_bbe0a_row3_col4, #T_bbe0a_row4_col0, #T_bbe0a_row5_col0, #T_bbe0a_row5_col5, #T_bbe0a_row6_col0, #T_bbe0a_row6_col6 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_bbe0a_row0_col2 {
  background-color: #056faf;
  color: #f1f1f1;
}
#T_bbe0a_row0_col4, #T_bbe0a_row4_col4, #T_bbe0a_row5_col4, #T_bbe0a_row6_col4 {
  background-color: #5ea0ca;
  color: #f1f1f1;
}
#T_bbe0a_row0_col5 {
  background-color: #69a5cc;
  color: #f1f1f1;
}
#T_bbe0a_row0_col6 {
  background-color: #c8cde4;
  color: #000000;
}
#T_bbe0a_row1_col0 {
  background-color: #9cb9d9;
  color: #000000;
}
#T_bbe0a_row1_col2, #T_bbe0a_row2_col4, #T_bbe0a_row3_col0, #T_bbe0a_row3_col3, #T_bbe0a_row4_col5, #T_bbe0a_row4_col6, #T_bbe0a_row5_col1 {
  background-color: #fff7fb;
  color: #000000;
}
#T_bbe0a_row1_col3 {
  background-color: #faf2f8;
  color: #000000;
}
#T_bbe0a_row1_col4 {
  background-color: #6da6cd;
  color: #f1f1f1;
}
#T_bbe0a_row1_col5 {
  background-color: #157ab5;
  color: #f1f1f1;
}
#T_bbe0a_row1_col6 {
  background-color: #d0d1e6;
  color: #000000;
}
#T_bbe0a_row2_col0, #T_bbe0a_row4_col1 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_bbe0a_row2_col3 {
  background-color: #fdf5fa;
  color: #000000;
}
#T_bbe0a_row2_col5, #T_bbe0a_row3_col5 {
  background-color: #84b0d3;
  color: #f1f1f1;
}
#T_bbe0a_row2_col6, #T_bbe0a_row3_col6 {
  background-color: #c4cbe3;
  color: #000000;
}
#T_bbe0a_row4_col2 {
  background-color: #4697c4;
  color: #f1f1f1;
}
#T_bbe0a_row4_col3, #T_bbe0a_row5_col3, #T_bbe0a_row6_col3 {
  background-color: #f1ebf5;
  color: #000000;
}
#T_bbe0a_row5_col2 {
  background-color: #03517e;
  color: #f1f1f1;
}
#T_bbe0a_row5_col6 {
  background-color: #d9d8ea;
  color: #000000;
}
#T_bbe0a_row6_col1 {
  background-color: #4295c3;
  color: #f1f1f1;
}
#T_bbe0a_row6_col2 {
  background-color: #2484ba;
  color: #f1f1f1;
}
#T_bbe0a_row6_col5 {
  background-color: #a7bddb;
  color: #000000;
}
</style>
<table id="T_bbe0a_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
      <th class="col_heading level0 col5" >5</th>
      <th class="col_heading level0 col6" >6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_bbe0a_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_bbe0a_row0_col0" class="data row0 col0" >-0.14</td>
      <td id="T_bbe0a_row0_col1" class="data row0 col1" >0.00</td>
      <td id="T_bbe0a_row0_col2" class="data row0 col2" >0.00</td>
      <td id="T_bbe0a_row0_col3" class="data row0 col3" >0.99</td>
      <td id="T_bbe0a_row0_col4" class="data row0 col4" >-0.00</td>
      <td id="T_bbe0a_row0_col5" class="data row0 col5" >-0.00</td>
      <td id="T_bbe0a_row0_col6" class="data row0 col6" >0.00</td>
    </tr>
    <tr>
      <th id="T_bbe0a_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_bbe0a_row1_col0" class="data row1 col0" >-0.42</td>
      <td id="T_bbe0a_row1_col1" class="data row1 col1" >0.00</td>
      <td id="T_bbe0a_row1_col2" class="data row1 col2" >-0.87</td>
      <td id="T_bbe0a_row1_col3" class="data row1 col3" >-0.06</td>
      <td id="T_bbe0a_row1_col4" class="data row1 col4" >-0.04</td>
      <td id="T_bbe0a_row1_col5" class="data row1 col5" >0.25</td>
      <td id="T_bbe0a_row1_col6" class="data row1 col6" >-0.03</td>
    </tr>
    <tr>
      <th id="T_bbe0a_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_bbe0a_row2_col0" class="data row2 col0" >-0.56</td>
      <td id="T_bbe0a_row2_col1" class="data row2 col1" >0.00</td>
      <td id="T_bbe0a_row2_col2" class="data row2 col2" >0.29</td>
      <td id="T_bbe0a_row2_col3" class="data row2 col3" >-0.08</td>
      <td id="T_bbe0a_row2_col4" class="data row2 col4" >-0.77</td>
      <td id="T_bbe0a_row2_col5" class="data row2 col5" >-0.08</td>
      <td id="T_bbe0a_row2_col6" class="data row2 col6" >0.01</td>
    </tr>
    <tr>
      <th id="T_bbe0a_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_bbe0a_row3_col0" class="data row3 col0" >-0.70</td>
      <td id="T_bbe0a_row3_col1" class="data row3 col1" >0.00</td>
      <td id="T_bbe0a_row3_col2" class="data row3 col2" >0.29</td>
      <td id="T_bbe0a_row3_col3" class="data row3 col3" >-0.10</td>
      <td id="T_bbe0a_row3_col4" class="data row3 col4" >0.64</td>
      <td id="T_bbe0a_row3_col5" class="data row3 col5" >-0.08</td>
      <td id="T_bbe0a_row3_col6" class="data row3 col6" >0.01</td>
    </tr>
    <tr>
      <th id="T_bbe0a_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_bbe0a_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_bbe0a_row4_col1" class="data row4 col1" >-0.60</td>
      <td id="T_bbe0a_row4_col2" class="data row4 col2" >-0.18</td>
      <td id="T_bbe0a_row4_col3" class="data row4 col3" >0.00</td>
      <td id="T_bbe0a_row4_col4" class="data row4 col4" >0.00</td>
      <td id="T_bbe0a_row4_col5" class="data row4 col5" >-0.70</td>
      <td id="T_bbe0a_row4_col6" class="data row4 col6" >-0.36</td>
    </tr>
    <tr>
      <th id="T_bbe0a_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_bbe0a_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_bbe0a_row5_col1" class="data row5 col1" >-0.75</td>
      <td id="T_bbe0a_row5_col2" class="data row5 col2" >0.18</td>
      <td id="T_bbe0a_row5_col3" class="data row5 col3" >0.00</td>
      <td id="T_bbe0a_row5_col4" class="data row5 col4" >0.00</td>
      <td id="T_bbe0a_row5_col5" class="data row5 col5" >0.63</td>
      <td id="T_bbe0a_row5_col6" class="data row5 col6" >-0.09</td>
    </tr>
    <tr>
      <th id="T_bbe0a_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_bbe0a_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_bbe0a_row6_col1" class="data row6 col1" >-0.30</td>
      <td id="T_bbe0a_row6_col2" class="data row6 col2" >-0.09</td>
      <td id="T_bbe0a_row6_col3" class="data row6 col3" >0.00</td>
      <td id="T_bbe0a_row6_col4" class="data row6 col4" >0.00</td>
      <td id="T_bbe0a_row6_col5" class="data row6 col5" >-0.20</td>
      <td id="T_bbe0a_row6_col6" class="data row6 col6" >0.93</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_0b260_row0_col0 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_0b260_row1_col0 {
  background-color: #056dab;
  color: #f1f1f1;
}
#T_0b260_row2_col0, #T_0b260_row3_col0, #T_0b260_row4_col0 {
  background-color: #fff7fb;
  color: #000000;
}
</style>
<table id="T_0b260_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0b260_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_0b260_row0_col0" class="data row0 col0" >12.37</td>
    </tr>
    <tr>
      <th id="T_0b260_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_0b260_row1_col0" class="data row1 col0" >9.49</td>
    </tr>
    <tr>
      <th id="T_0b260_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_0b260_row2_col0" class="data row2 col0" >0.00</td>
    </tr>
    <tr>
      <th id="T_0b260_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_0b260_row3_col0" class="data row3 col0" >0.00</td>
    </tr>
    <tr>
      <th id="T_0b260_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_0b260_row4_col0" class="data row4 col0" >0.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_aeb30_row0_col0 {
  background-color: #c2cbe2;
  color: #000000;
}
#T_aeb30_row0_col1, #T_aeb30_row1_col3, #T_aeb30_row1_col4, #T_aeb30_row2_col3, #T_aeb30_row3_col0, #T_aeb30_row4_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_aeb30_row0_col2 {
  background-color: #eee8f3;
  color: #000000;
}
#T_aeb30_row0_col3, #T_aeb30_row1_col0, #T_aeb30_row2_col0, #T_aeb30_row2_col4, #T_aeb30_row3_col2, #T_aeb30_row3_col3, #T_aeb30_row4_col0, #T_aeb30_row4_col1, #T_aeb30_row4_col3 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_aeb30_row0_col4, #T_aeb30_row3_col4, #T_aeb30_row4_col4 {
  background-color: #73a9cf;
  color: #f1f1f1;
}
#T_aeb30_row1_col1, #T_aeb30_row2_col1 {
  background-color: #88b1d4;
  color: #000000;
}
#T_aeb30_row1_col2, #T_aeb30_row2_col2 {
  background-color: #328dbf;
  color: #f1f1f1;
}
#T_aeb30_row3_col1 {
  background-color: #056dab;
  color: #f1f1f1;
}
</style>
<table id="T_aeb30_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_aeb30_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_aeb30_row0_col0" class="data row0 col0" >-0.58</td>
      <td id="T_aeb30_row0_col1" class="data row0 col1" >-0.58</td>
      <td id="T_aeb30_row0_col2" class="data row0 col2" >-0.58</td>
      <td id="T_aeb30_row0_col3" class="data row0 col3" >-0.00</td>
      <td id="T_aeb30_row0_col4" class="data row0 col4" >-0.00</td>
    </tr>
    <tr>
      <th id="T_aeb30_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_aeb30_row1_col0" class="data row1 col0" >-0.00</td>
      <td id="T_aeb30_row1_col1" class="data row1 col1" >-0.00</td>
      <td id="T_aeb30_row1_col2" class="data row1 col2" >-0.00</td>
      <td id="T_aeb30_row1_col3" class="data row1 col3" >-0.71</td>
      <td id="T_aeb30_row1_col4" class="data row1 col4" >-0.71</td>
    </tr>
    <tr>
      <th id="T_aeb30_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_aeb30_row2_col0" class="data row2 col0" >0.00</td>
      <td id="T_aeb30_row2_col1" class="data row2 col1" >0.00</td>
      <td id="T_aeb30_row2_col2" class="data row2 col2" >0.00</td>
      <td id="T_aeb30_row2_col3" class="data row2 col3" >-0.71</td>
      <td id="T_aeb30_row2_col4" class="data row2 col4" >0.71</td>
    </tr>
    <tr>
      <th id="T_aeb30_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_aeb30_row3_col0" class="data row3 col0" >-0.82</td>
      <td id="T_aeb30_row3_col1" class="data row3 col1" >0.41</td>
      <td id="T_aeb30_row3_col2" class="data row3 col2" >0.41</td>
      <td id="T_aeb30_row3_col3" class="data row3 col3" >-0.00</td>
      <td id="T_aeb30_row3_col4" class="data row3 col4" >-0.00</td>
    </tr>
    <tr>
      <th id="T_aeb30_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_aeb30_row4_col0" class="data row4 col0" >-0.00</td>
      <td id="T_aeb30_row4_col1" class="data row4 col1" >0.71</td>
      <td id="T_aeb30_row4_col2" class="data row4 col2" >-0.71</td>
      <td id="T_aeb30_row4_col3" class="data row4 col3" >-0.00</td>
      <td id="T_aeb30_row4_col4" class="data row4 col4" >-0.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">U</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">])</span>   <span class="c1"># User to concept similarity</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_000c1_row0_col0 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_000c1_row0_col1, #T_000c1_row1_col1, #T_000c1_row2_col1, #T_000c1_row3_col1, #T_000c1_row4_col0, #T_000c1_row5_col0, #T_000c1_row6_col0 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_000c1_row1_col0 {
  background-color: #9cb9d9;
  color: #000000;
}
#T_000c1_row2_col0, #T_000c1_row4_col1 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_000c1_row3_col0, #T_000c1_row5_col1 {
  background-color: #fff7fb;
  color: #000000;
}
#T_000c1_row6_col1 {
  background-color: #4295c3;
  color: #f1f1f1;
}
</style>
<table id="T_000c1_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_000c1_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_000c1_row0_col0" class="data row0 col0" >-0.14</td>
      <td id="T_000c1_row0_col1" class="data row0 col1" >0.00</td>
    </tr>
    <tr>
      <th id="T_000c1_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_000c1_row1_col0" class="data row1 col0" >-0.42</td>
      <td id="T_000c1_row1_col1" class="data row1 col1" >0.00</td>
    </tr>
    <tr>
      <th id="T_000c1_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_000c1_row2_col0" class="data row2 col0" >-0.56</td>
      <td id="T_000c1_row2_col1" class="data row2 col1" >0.00</td>
    </tr>
    <tr>
      <th id="T_000c1_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_000c1_row3_col0" class="data row3 col0" >-0.70</td>
      <td id="T_000c1_row3_col1" class="data row3 col1" >0.00</td>
    </tr>
    <tr>
      <th id="T_000c1_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_000c1_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_000c1_row4_col1" class="data row4 col1" >-0.60</td>
    </tr>
    <tr>
      <th id="T_000c1_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_000c1_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_000c1_row5_col1" class="data row5 col1" >-0.75</td>
    </tr>
    <tr>
      <th id="T_000c1_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_000c1_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_000c1_row6_col1" class="data row6 col1" >-0.30</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">S</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>      <span class="c1"># Concept strengths</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_82a0e_row0_col0 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_82a0e_row1_col0 {
  background-color: #fff7fb;
  color: #000000;
}
</style>
<table id="T_82a0e_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_82a0e_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_82a0e_row0_col0" class="data row0 col0" >12.37</td>
    </tr>
    <tr>
      <th id="T_82a0e_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_82a0e_row1_col0" class="data row1 col0" >9.49</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>    <span class="c1"># Movie to concept similarity</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_c6c4a_row0_col0, #T_c6c4a_row0_col1, #T_c6c4a_row0_col2, #T_c6c4a_row1_col3, #T_c6c4a_row1_col4 {
  background-color: #fff7fb;
  color: #000000;
}
#T_c6c4a_row0_col3, #T_c6c4a_row0_col4, #T_c6c4a_row1_col0, #T_c6c4a_row1_col1, #T_c6c4a_row1_col2 {
  background-color: #023858;
  color: #f1f1f1;
}
</style>
<table id="T_c6c4a_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_c6c4a_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_c6c4a_row0_col0" class="data row0 col0" >-0.58</td>
      <td id="T_c6c4a_row0_col1" class="data row0 col1" >-0.58</td>
      <td id="T_c6c4a_row0_col2" class="data row0 col2" >-0.58</td>
      <td id="T_c6c4a_row0_col3" class="data row0 col3" >-0.00</td>
      <td id="T_c6c4a_row0_col4" class="data row0 col4" >-0.00</td>
    </tr>
    <tr>
      <th id="T_c6c4a_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_c6c4a_row1_col0" class="data row1 col0" >-0.00</td>
      <td id="T_c6c4a_row1_col1" class="data row1 col1" >-0.00</td>
      <td id="T_c6c4a_row1_col2" class="data row1 col2" >-0.00</td>
      <td id="T_c6c4a_row1_col3" class="data row1 col3" >-0.71</td>
      <td id="T_c6c4a_row1_col4" class="data row1 col4" >-0.71</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">((</span><span class="n">U</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_e78f1_row0_col0, #T_e78f1_row0_col1, #T_e78f1_row0_col2 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_e78f1_row0_col3, #T_e78f1_row0_col4, #T_e78f1_row1_col3, #T_e78f1_row1_col4, #T_e78f1_row2_col3, #T_e78f1_row2_col4, #T_e78f1_row3_col3, #T_e78f1_row3_col4, #T_e78f1_row4_col0, #T_e78f1_row4_col1, #T_e78f1_row4_col2, #T_e78f1_row5_col0, #T_e78f1_row5_col1, #T_e78f1_row5_col2, #T_e78f1_row6_col0, #T_e78f1_row6_col1, #T_e78f1_row6_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_e78f1_row1_col0, #T_e78f1_row1_col1, #T_e78f1_row1_col2 {
  background-color: #4295c3;
  color: #f1f1f1;
}
#T_e78f1_row2_col0, #T_e78f1_row2_col1, #T_e78f1_row2_col2, #T_e78f1_row4_col3, #T_e78f1_row4_col4 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_e78f1_row3_col0, #T_e78f1_row3_col1, #T_e78f1_row3_col2, #T_e78f1_row5_col3, #T_e78f1_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_e78f1_row6_col3, #T_e78f1_row6_col4 {
  background-color: #9cb9d9;
  color: #000000;
}
</style>
<table id="T_e78f1_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e78f1_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_e78f1_row0_col0" class="data row0 col0" >1.00</td>
      <td id="T_e78f1_row0_col1" class="data row0 col1" >1.00</td>
      <td id="T_e78f1_row0_col2" class="data row0 col2" >1.00</td>
      <td id="T_e78f1_row0_col3" class="data row0 col3" >0.00</td>
      <td id="T_e78f1_row0_col4" class="data row0 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_e78f1_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_e78f1_row1_col0" class="data row1 col0" >3.00</td>
      <td id="T_e78f1_row1_col1" class="data row1 col1" >3.00</td>
      <td id="T_e78f1_row1_col2" class="data row1 col2" >3.00</td>
      <td id="T_e78f1_row1_col3" class="data row1 col3" >0.00</td>
      <td id="T_e78f1_row1_col4" class="data row1 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_e78f1_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_e78f1_row2_col0" class="data row2 col0" >4.00</td>
      <td id="T_e78f1_row2_col1" class="data row2 col1" >4.00</td>
      <td id="T_e78f1_row2_col2" class="data row2 col2" >4.00</td>
      <td id="T_e78f1_row2_col3" class="data row2 col3" >0.00</td>
      <td id="T_e78f1_row2_col4" class="data row2 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_e78f1_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_e78f1_row3_col0" class="data row3 col0" >5.00</td>
      <td id="T_e78f1_row3_col1" class="data row3 col1" >5.00</td>
      <td id="T_e78f1_row3_col2" class="data row3 col2" >5.00</td>
      <td id="T_e78f1_row3_col3" class="data row3 col3" >0.00</td>
      <td id="T_e78f1_row3_col4" class="data row3 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_e78f1_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_e78f1_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_e78f1_row4_col1" class="data row4 col1" >0.00</td>
      <td id="T_e78f1_row4_col2" class="data row4 col2" >0.00</td>
      <td id="T_e78f1_row4_col3" class="data row4 col3" >4.00</td>
      <td id="T_e78f1_row4_col4" class="data row4 col4" >4.00</td>
    </tr>
    <tr>
      <th id="T_e78f1_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_e78f1_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_e78f1_row5_col1" class="data row5 col1" >0.00</td>
      <td id="T_e78f1_row5_col2" class="data row5 col2" >0.00</td>
      <td id="T_e78f1_row5_col3" class="data row5 col3" >5.00</td>
      <td id="T_e78f1_row5_col4" class="data row5 col4" >5.00</td>
    </tr>
    <tr>
      <th id="T_e78f1_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_e78f1_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_e78f1_row6_col1" class="data row6 col1" >0.00</td>
      <td id="T_e78f1_row6_col2" class="data row6 col2" >0.00</td>
      <td id="T_e78f1_row6_col3" class="data row6 col3" >2.00</td>
      <td id="T_e78f1_row6_col4" class="data row6 col4" >2.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>What if we add some noise?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;Alien&#39;</span><span class="p">,</span> <span class="s1">&#39;Serenity&#39;</span><span class="p">,</span> <span class="s1">&#39;Casablanca&#39;</span><span class="p">,</span> <span class="s1">&#39;Amelie&#39;</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_cf776_row0_col0, #T_cf776_row0_col1, #T_cf776_row0_col2, #T_cf776_row6_col1 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_cf776_row0_col3, #T_cf776_row0_col4, #T_cf776_row1_col3, #T_cf776_row1_col4, #T_cf776_row2_col3, #T_cf776_row2_col4, #T_cf776_row3_col3, #T_cf776_row3_col4, #T_cf776_row4_col0, #T_cf776_row4_col2, #T_cf776_row5_col0, #T_cf776_row5_col1, #T_cf776_row5_col2, #T_cf776_row6_col0, #T_cf776_row6_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_cf776_row1_col0, #T_cf776_row1_col1, #T_cf776_row1_col2 {
  background-color: #4295c3;
  color: #f1f1f1;
}
#T_cf776_row2_col0, #T_cf776_row2_col1, #T_cf776_row2_col2, #T_cf776_row4_col3, #T_cf776_row4_col4 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_cf776_row3_col0, #T_cf776_row3_col1, #T_cf776_row3_col2, #T_cf776_row5_col3, #T_cf776_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_cf776_row4_col1, #T_cf776_row6_col3, #T_cf776_row6_col4 {
  background-color: #9cb9d9;
  color: #000000;
}
</style>
<table id="T_cf776_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >Matrix</th>
      <th class="col_heading level0 col1" >Alien</th>
      <th class="col_heading level0 col2" >Serenity</th>
      <th class="col_heading level0 col3" >Casablanca</th>
      <th class="col_heading level0 col4" >Amelie</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_cf776_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_cf776_row0_col0" class="data row0 col0" >1.00</td>
      <td id="T_cf776_row0_col1" class="data row0 col1" >1.00</td>
      <td id="T_cf776_row0_col2" class="data row0 col2" >1.00</td>
      <td id="T_cf776_row0_col3" class="data row0 col3" >0.00</td>
      <td id="T_cf776_row0_col4" class="data row0 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf776_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_cf776_row1_col0" class="data row1 col0" >3.00</td>
      <td id="T_cf776_row1_col1" class="data row1 col1" >3.00</td>
      <td id="T_cf776_row1_col2" class="data row1 col2" >3.00</td>
      <td id="T_cf776_row1_col3" class="data row1 col3" >0.00</td>
      <td id="T_cf776_row1_col4" class="data row1 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf776_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_cf776_row2_col0" class="data row2 col0" >4.00</td>
      <td id="T_cf776_row2_col1" class="data row2 col1" >4.00</td>
      <td id="T_cf776_row2_col2" class="data row2 col2" >4.00</td>
      <td id="T_cf776_row2_col3" class="data row2 col3" >0.00</td>
      <td id="T_cf776_row2_col4" class="data row2 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf776_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_cf776_row3_col0" class="data row3 col0" >5.00</td>
      <td id="T_cf776_row3_col1" class="data row3 col1" >5.00</td>
      <td id="T_cf776_row3_col2" class="data row3 col2" >5.00</td>
      <td id="T_cf776_row3_col3" class="data row3 col3" >0.00</td>
      <td id="T_cf776_row3_col4" class="data row3 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf776_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_cf776_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_cf776_row4_col1" class="data row4 col1" >2.00</td>
      <td id="T_cf776_row4_col2" class="data row4 col2" >0.00</td>
      <td id="T_cf776_row4_col3" class="data row4 col3" >4.00</td>
      <td id="T_cf776_row4_col4" class="data row4 col4" >4.00</td>
    </tr>
    <tr>
      <th id="T_cf776_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_cf776_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_cf776_row5_col1" class="data row5 col1" >0.00</td>
      <td id="T_cf776_row5_col2" class="data row5 col2" >0.00</td>
      <td id="T_cf776_row5_col3" class="data row5 col3" >5.00</td>
      <td id="T_cf776_row5_col4" class="data row5 col4" >5.00</td>
    </tr>
    <tr>
      <th id="T_cf776_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_cf776_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_cf776_row6_col1" class="data row6 col1" >1.00</td>
      <td id="T_cf776_row6_col2" class="data row6 col2" >0.00</td>
      <td id="T_cf776_row6_col3" class="data row6 col3" >2.00</td>
      <td id="T_cf776_row6_col4" class="data row6 col4" >2.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">U</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">])</span>   <span class="c1"># User to concept similarity</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_a7dcb_row0_col0 {
  background-color: #045585;
  color: #f1f1f1;
}
#T_a7dcb_row0_col1 {
  background-color: #eee9f3;
  color: #000000;
}
#T_a7dcb_row0_col2 {
  background-color: #73a9cf;
  color: #f1f1f1;
}
#T_a7dcb_row1_col0 {
  background-color: #89b1d4;
  color: #000000;
}
#T_a7dcb_row1_col1 {
  background-color: #f7f0f7;
  color: #000000;
}
#T_a7dcb_row1_col2, #T_a7dcb_row6_col1 {
  background-color: #79abd0;
  color: #f1f1f1;
}
#T_a7dcb_row2_col0 {
  background-color: #d6d6e9;
  color: #000000;
}
#T_a7dcb_row2_col1 {
  background-color: #fbf3f9;
  color: #000000;
}
#T_a7dcb_row2_col2 {
  background-color: #7dacd1;
  color: #f1f1f1;
}
#T_a7dcb_row3_col0, #T_a7dcb_row3_col1, #T_a7dcb_row5_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_a7dcb_row3_col2 {
  background-color: #81aed2;
  color: #f1f1f1;
}
#T_a7dcb_row4_col0 {
  background-color: #045b8e;
  color: #f1f1f1;
}
#T_a7dcb_row4_col1 {
  background-color: #046198;
  color: #f1f1f1;
}
#T_a7dcb_row4_col2, #T_a7dcb_row5_col0, #T_a7dcb_row5_col1 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_a7dcb_row6_col0 {
  background-color: #02395a;
  color: #f1f1f1;
}
#T_a7dcb_row6_col2 {
  background-color: #056fae;
  color: #f1f1f1;
}
</style>
<table id="T_a7dcb_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_a7dcb_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_a7dcb_row0_col0" class="data row0 col0" >-0.14</td>
      <td id="T_a7dcb_row0_col1" class="data row0 col1" >-0.02</td>
      <td id="T_a7dcb_row0_col2" class="data row0 col2" >-0.01</td>
    </tr>
    <tr>
      <th id="T_a7dcb_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_a7dcb_row1_col0" class="data row1 col0" >-0.41</td>
      <td id="T_a7dcb_row1_col1" class="data row1 col1" >-0.07</td>
      <td id="T_a7dcb_row1_col2" class="data row1 col2" >-0.03</td>
    </tr>
    <tr>
      <th id="T_a7dcb_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_a7dcb_row2_col0" class="data row2 col0" >-0.55</td>
      <td id="T_a7dcb_row2_col1" class="data row2 col1" >-0.09</td>
      <td id="T_a7dcb_row2_col2" class="data row2 col2" >-0.04</td>
    </tr>
    <tr>
      <th id="T_a7dcb_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_a7dcb_row3_col0" class="data row3 col0" >-0.69</td>
      <td id="T_a7dcb_row3_col1" class="data row3 col1" >-0.12</td>
      <td id="T_a7dcb_row3_col2" class="data row3 col2" >-0.05</td>
    </tr>
    <tr>
      <th id="T_a7dcb_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_a7dcb_row4_col0" class="data row4 col0" >-0.15</td>
      <td id="T_a7dcb_row4_col1" class="data row4 col1" >0.59</td>
      <td id="T_a7dcb_row4_col2" class="data row4 col2" >0.65</td>
    </tr>
    <tr>
      <th id="T_a7dcb_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_a7dcb_row5_col0" class="data row5 col0" >-0.07</td>
      <td id="T_a7dcb_row5_col1" class="data row5 col1" >0.73</td>
      <td id="T_a7dcb_row5_col2" class="data row5 col2" >-0.68</td>
    </tr>
    <tr>
      <th id="T_a7dcb_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_a7dcb_row6_col0" class="data row6 col0" >-0.08</td>
      <td id="T_a7dcb_row6_col1" class="data row6 col1" >0.30</td>
      <td id="T_a7dcb_row6_col2" class="data row6 col2" >0.33</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">S</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>      <span class="c1"># Concept strengths</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_97bb6_row0_col0 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_97bb6_row1_col0 {
  background-color: #0c74b2;
  color: #f1f1f1;
}
#T_97bb6_row2_col0 {
  background-color: #fff7fb;
  color: #000000;
}
</style>
<table id="T_97bb6_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_97bb6_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_97bb6_row0_col0" class="data row0 col0" >12.48</td>
    </tr>
    <tr>
      <th id="T_97bb6_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_97bb6_row1_col0" class="data row1 col0" >9.51</td>
    </tr>
    <tr>
      <th id="T_97bb6_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_97bb6_row2_col0" class="data row2 col0" >1.35</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>    <span class="c1"># Movie to concept similarity</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_561e2_row0_col0, #T_561e2_row0_col1, #T_561e2_row0_col2, #T_561e2_row0_col3, #T_561e2_row0_col4, #T_561e2_row2_col3, #T_561e2_row2_col4 {
  background-color: #fff7fb;
  color: #000000;
}
#T_561e2_row1_col0, #T_561e2_row1_col2, #T_561e2_row1_col3, #T_561e2_row1_col4, #T_561e2_row2_col1 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_561e2_row1_col1 {
  background-color: #8bb2d4;
  color: #000000;
}
#T_561e2_row2_col0, #T_561e2_row2_col2 {
  background-color: #afc1dd;
  color: #000000;
}
</style>
<table id="T_561e2_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_561e2_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_561e2_row0_col0" class="data row0 col0" >-0.56</td>
      <td id="T_561e2_row0_col1" class="data row0 col1" >-0.59</td>
      <td id="T_561e2_row0_col2" class="data row0 col2" >-0.56</td>
      <td id="T_561e2_row0_col3" class="data row0 col3" >-0.09</td>
      <td id="T_561e2_row0_col4" class="data row0 col4" >-0.09</td>
    </tr>
    <tr>
      <th id="T_561e2_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_561e2_row1_col0" class="data row1 col0" >-0.13</td>
      <td id="T_561e2_row1_col1" class="data row1 col1" >0.03</td>
      <td id="T_561e2_row1_col2" class="data row1 col2" >-0.13</td>
      <td id="T_561e2_row1_col3" class="data row1 col3" >0.70</td>
      <td id="T_561e2_row1_col4" class="data row1 col4" >0.70</td>
    </tr>
    <tr>
      <th id="T_561e2_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_561e2_row2_col0" class="data row2 col0" >-0.41</td>
      <td id="T_561e2_row2_col1" class="data row2 col1" >0.80</td>
      <td id="T_561e2_row2_col2" class="data row2 col2" >-0.41</td>
      <td id="T_561e2_row2_col3" class="data row2 col3" >-0.09</td>
      <td id="T_561e2_row2_col4" class="data row2 col4" >-0.09</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">((</span><span class="n">U</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_cf982_row0_col0, #T_cf982_row0_col1, #T_cf982_row0_col2, #T_cf982_row6_col1 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_cf982_row0_col3, #T_cf982_row0_col4, #T_cf982_row1_col3, #T_cf982_row1_col4, #T_cf982_row2_col3, #T_cf982_row2_col4, #T_cf982_row3_col3, #T_cf982_row3_col4, #T_cf982_row4_col0, #T_cf982_row4_col2, #T_cf982_row5_col0, #T_cf982_row5_col1, #T_cf982_row5_col2, #T_cf982_row6_col0, #T_cf982_row6_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_cf982_row1_col0, #T_cf982_row1_col1, #T_cf982_row1_col2 {
  background-color: #4295c3;
  color: #f1f1f1;
}
#T_cf982_row2_col0, #T_cf982_row2_col1, #T_cf982_row2_col2, #T_cf982_row4_col3, #T_cf982_row4_col4 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_cf982_row3_col0, #T_cf982_row3_col1, #T_cf982_row3_col2, #T_cf982_row5_col3, #T_cf982_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_cf982_row4_col1, #T_cf982_row6_col3, #T_cf982_row6_col4 {
  background-color: #9cb9d9;
  color: #000000;
}
</style>
<table id="T_cf982_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_cf982_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_cf982_row0_col0" class="data row0 col0" >1.00</td>
      <td id="T_cf982_row0_col1" class="data row0 col1" >1.00</td>
      <td id="T_cf982_row0_col2" class="data row0 col2" >1.00</td>
      <td id="T_cf982_row0_col3" class="data row0 col3" >0.00</td>
      <td id="T_cf982_row0_col4" class="data row0 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf982_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_cf982_row1_col0" class="data row1 col0" >3.00</td>
      <td id="T_cf982_row1_col1" class="data row1 col1" >3.00</td>
      <td id="T_cf982_row1_col2" class="data row1 col2" >3.00</td>
      <td id="T_cf982_row1_col3" class="data row1 col3" >-0.00</td>
      <td id="T_cf982_row1_col4" class="data row1 col4" >-0.00</td>
    </tr>
    <tr>
      <th id="T_cf982_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_cf982_row2_col0" class="data row2 col0" >4.00</td>
      <td id="T_cf982_row2_col1" class="data row2 col1" >4.00</td>
      <td id="T_cf982_row2_col2" class="data row2 col2" >4.00</td>
      <td id="T_cf982_row2_col3" class="data row2 col3" >0.00</td>
      <td id="T_cf982_row2_col4" class="data row2 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf982_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_cf982_row3_col0" class="data row3 col0" >5.00</td>
      <td id="T_cf982_row3_col1" class="data row3 col1" >5.00</td>
      <td id="T_cf982_row3_col2" class="data row3 col2" >5.00</td>
      <td id="T_cf982_row3_col3" class="data row3 col3" >0.00</td>
      <td id="T_cf982_row3_col4" class="data row3 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_cf982_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_cf982_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_cf982_row4_col1" class="data row4 col1" >2.00</td>
      <td id="T_cf982_row4_col2" class="data row4 col2" >-0.00</td>
      <td id="T_cf982_row4_col3" class="data row4 col3" >4.00</td>
      <td id="T_cf982_row4_col4" class="data row4 col4" >4.00</td>
    </tr>
    <tr>
      <th id="T_cf982_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_cf982_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_cf982_row5_col1" class="data row5 col1" >-0.00</td>
      <td id="T_cf982_row5_col2" class="data row5 col2" >0.00</td>
      <td id="T_cf982_row5_col3" class="data row5 col3" >5.00</td>
      <td id="T_cf982_row5_col4" class="data row5 col4" >5.00</td>
    </tr>
    <tr>
      <th id="T_cf982_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_cf982_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_cf982_row6_col1" class="data row6 col1" >1.00</td>
      <td id="T_cf982_row6_col2" class="data row6 col2" >-0.00</td>
      <td id="T_cf982_row6_col3" class="data row6 col3" >2.00</td>
      <td id="T_cf982_row6_col4" class="data row6 col4" >2.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Or an approximation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">((</span><span class="n">U</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_25230_row0_col0, #T_25230_row0_col2 {
  background-color: #ced0e6;
  color: #000000;
}
#T_25230_row0_col1 {
  background-color: #f2ecf5;
  color: #000000;
}
#T_25230_row0_col3, #T_25230_row0_col4, #T_25230_row1_col3, #T_25230_row1_col4, #T_25230_row2_col3, #T_25230_row2_col4, #T_25230_row3_col3, #T_25230_row3_col4, #T_25230_row5_col0, #T_25230_row5_col2, #T_25230_row6_col1 {
  background-color: #fff7fb;
  color: #000000;
}
#T_25230_row1_col0, #T_25230_row1_col2 {
  background-color: #358fc0;
  color: #f1f1f1;
}
#T_25230_row1_col1 {
  background-color: #60a1ca;
  color: #f1f1f1;
}
#T_25230_row2_col0, #T_25230_row2_col2 {
  background-color: #04649e;
  color: #f1f1f1;
}
#T_25230_row2_col1 {
  background-color: #056caa;
  color: #f1f1f1;
}
#T_25230_row3_col0, #T_25230_row3_col1, #T_25230_row3_col2, #T_25230_row5_col3, #T_25230_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_25230_row4_col0, #T_25230_row4_col2 {
  background-color: #e9e5f1;
  color: #000000;
}
#T_25230_row4_col1 {
  background-color: #e7e3f0;
  color: #000000;
}
#T_25230_row4_col3, #T_25230_row4_col4 {
  background-color: #046299;
  color: #f1f1f1;
}
#T_25230_row5_col1 {
  background-color: #fcf4fa;
  color: #000000;
}
#T_25230_row6_col0, #T_25230_row6_col2 {
  background-color: #f0eaf4;
  color: #000000;
}
#T_25230_row6_col3, #T_25230_row6_col4 {
  background-color: #96b6d7;
  color: #000000;
}
</style>
<table id="T_25230_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_25230_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_25230_row0_col0" class="data row0 col0" >0.99</td>
      <td id="T_25230_row0_col1" class="data row0 col1" >1.01</td>
      <td id="T_25230_row0_col2" class="data row0 col2" >0.99</td>
      <td id="T_25230_row0_col3" class="data row0 col3" >-0.00</td>
      <td id="T_25230_row0_col4" class="data row0 col4" >-0.00</td>
    </tr>
    <tr>
      <th id="T_25230_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_25230_row1_col0" class="data row1 col0" >2.98</td>
      <td id="T_25230_row1_col1" class="data row1 col1" >3.04</td>
      <td id="T_25230_row1_col2" class="data row1 col2" >2.98</td>
      <td id="T_25230_row1_col3" class="data row1 col3" >-0.00</td>
      <td id="T_25230_row1_col4" class="data row1 col4" >-0.00</td>
    </tr>
    <tr>
      <th id="T_25230_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_25230_row2_col0" class="data row2 col0" >3.98</td>
      <td id="T_25230_row2_col1" class="data row2 col1" >4.05</td>
      <td id="T_25230_row2_col2" class="data row2 col2" >3.98</td>
      <td id="T_25230_row2_col3" class="data row2 col3" >-0.01</td>
      <td id="T_25230_row2_col4" class="data row2 col4" >-0.01</td>
    </tr>
    <tr>
      <th id="T_25230_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_25230_row3_col0" class="data row3 col0" >4.97</td>
      <td id="T_25230_row3_col1" class="data row3 col1" >5.06</td>
      <td id="T_25230_row3_col2" class="data row3 col2" >4.97</td>
      <td id="T_25230_row3_col3" class="data row3 col3" >-0.01</td>
      <td id="T_25230_row3_col4" class="data row3 col4" >-0.01</td>
    </tr>
    <tr>
      <th id="T_25230_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_25230_row4_col0" class="data row4 col0" >0.36</td>
      <td id="T_25230_row4_col1" class="data row4 col1" >1.29</td>
      <td id="T_25230_row4_col2" class="data row4 col2" >0.36</td>
      <td id="T_25230_row4_col3" class="data row4 col3" >4.08</td>
      <td id="T_25230_row4_col4" class="data row4 col4" >4.08</td>
    </tr>
    <tr>
      <th id="T_25230_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_25230_row5_col0" class="data row5 col0" >-0.37</td>
      <td id="T_25230_row5_col1" class="data row5 col1" >0.73</td>
      <td id="T_25230_row5_col2" class="data row5 col2" >-0.37</td>
      <td id="T_25230_row5_col3" class="data row5 col3" >4.92</td>
      <td id="T_25230_row5_col4" class="data row5 col4" >4.92</td>
    </tr>
    <tr>
      <th id="T_25230_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_25230_row6_col0" class="data row6 col0" >0.18</td>
      <td id="T_25230_row6_col1" class="data row6 col1" >0.65</td>
      <td id="T_25230_row6_col2" class="data row6 col2" >0.18</td>
      <td id="T_25230_row6_col3" class="data row6 col3" >2.04</td>
      <td id="T_25230_row6_col4" class="data row6 col4" >2.04</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="simplest-recommender">
<h3>Simplest recommender<a class="headerlink" href="#simplest-recommender" title="Link to this heading">#</a></h3>
<p>Let’s add some missing ratings into the mix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;Alien&#39;</span><span class="p">,</span> <span class="s1">&#39;Serenity&#39;</span><span class="p">,</span> <span class="s1">&#39;Casablanca&#39;</span><span class="p">,</span> <span class="s1">&#39;Amelie&#39;</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_6eea8_row0_col0, #T_6eea8_row0_col1, #T_6eea8_row0_col2, #T_6eea8_row6_col1 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_6eea8_row0_col3, #T_6eea8_row0_col4, #T_6eea8_row1_col0, #T_6eea8_row1_col3, #T_6eea8_row1_col4, #T_6eea8_row2_col2, #T_6eea8_row2_col3, #T_6eea8_row2_col4, #T_6eea8_row3_col3, #T_6eea8_row3_col4, #T_6eea8_row4_col0, #T_6eea8_row4_col2, #T_6eea8_row5_col0, #T_6eea8_row5_col1, #T_6eea8_row5_col2, #T_6eea8_row6_col0, #T_6eea8_row6_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_6eea8_row1_col1, #T_6eea8_row1_col2 {
  background-color: #4295c3;
  color: #f1f1f1;
}
#T_6eea8_row2_col0, #T_6eea8_row2_col1, #T_6eea8_row4_col3, #T_6eea8_row4_col4 {
  background-color: #0567a2;
  color: #f1f1f1;
}
#T_6eea8_row3_col0, #T_6eea8_row3_col1, #T_6eea8_row3_col2, #T_6eea8_row5_col3, #T_6eea8_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_6eea8_row4_col1, #T_6eea8_row6_col3, #T_6eea8_row6_col4 {
  background-color: #9cb9d9;
  color: #000000;
}
</style>
<table id="T_6eea8_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >Matrix</th>
      <th class="col_heading level0 col1" >Alien</th>
      <th class="col_heading level0 col2" >Serenity</th>
      <th class="col_heading level0 col3" >Casablanca</th>
      <th class="col_heading level0 col4" >Amelie</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_6eea8_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_6eea8_row0_col0" class="data row0 col0" >1.00</td>
      <td id="T_6eea8_row0_col1" class="data row0 col1" >1.00</td>
      <td id="T_6eea8_row0_col2" class="data row0 col2" >1.00</td>
      <td id="T_6eea8_row0_col3" class="data row0 col3" >0.00</td>
      <td id="T_6eea8_row0_col4" class="data row0 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6eea8_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_6eea8_row1_col0" class="data row1 col0" >0.00</td>
      <td id="T_6eea8_row1_col1" class="data row1 col1" >3.00</td>
      <td id="T_6eea8_row1_col2" class="data row1 col2" >3.00</td>
      <td id="T_6eea8_row1_col3" class="data row1 col3" >0.00</td>
      <td id="T_6eea8_row1_col4" class="data row1 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6eea8_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_6eea8_row2_col0" class="data row2 col0" >4.00</td>
      <td id="T_6eea8_row2_col1" class="data row2 col1" >4.00</td>
      <td id="T_6eea8_row2_col2" class="data row2 col2" >0.00</td>
      <td id="T_6eea8_row2_col3" class="data row2 col3" >0.00</td>
      <td id="T_6eea8_row2_col4" class="data row2 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6eea8_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_6eea8_row3_col0" class="data row3 col0" >5.00</td>
      <td id="T_6eea8_row3_col1" class="data row3 col1" >5.00</td>
      <td id="T_6eea8_row3_col2" class="data row3 col2" >5.00</td>
      <td id="T_6eea8_row3_col3" class="data row3 col3" >0.00</td>
      <td id="T_6eea8_row3_col4" class="data row3 col4" >0.00</td>
    </tr>
    <tr>
      <th id="T_6eea8_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_6eea8_row4_col0" class="data row4 col0" >0.00</td>
      <td id="T_6eea8_row4_col1" class="data row4 col1" >2.00</td>
      <td id="T_6eea8_row4_col2" class="data row4 col2" >0.00</td>
      <td id="T_6eea8_row4_col3" class="data row4 col3" >4.00</td>
      <td id="T_6eea8_row4_col4" class="data row4 col4" >4.00</td>
    </tr>
    <tr>
      <th id="T_6eea8_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_6eea8_row5_col0" class="data row5 col0" >0.00</td>
      <td id="T_6eea8_row5_col1" class="data row5 col1" >0.00</td>
      <td id="T_6eea8_row5_col2" class="data row5 col2" >0.00</td>
      <td id="T_6eea8_row5_col3" class="data row5 col3" >5.00</td>
      <td id="T_6eea8_row5_col4" class="data row5 col4" >5.00</td>
    </tr>
    <tr>
      <th id="T_6eea8_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_6eea8_row6_col0" class="data row6 col0" >0.00</td>
      <td id="T_6eea8_row6_col1" class="data row6 col1" >1.00</td>
      <td id="T_6eea8_row6_col2" class="data row6 col2" >0.00</td>
      <td id="T_6eea8_row6_col3" class="data row6 col3" >2.00</td>
      <td id="T_6eea8_row6_col4" class="data row6 col4" >2.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Trick is that SVD will tend to ignore/remove some of these ‘mistakes’ and end up imputing missing ratings!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">display</span><span class="p">((</span><span class="n">U</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_4c737_row0_col0 {
  background-color: #cccfe5;
  color: #000000;
}
#T_4c737_row0_col1 {
  background-color: #f0eaf4;
  color: #000000;
}
#T_4c737_row0_col2 {
  background-color: #cacee5;
  color: #000000;
}
#T_4c737_row0_col3, #T_4c737_row0_col4, #T_4c737_row6_col1 {
  background-color: #fdf5fa;
  color: #000000;
}
#T_4c737_row1_col0, #T_4c737_row1_col2 {
  background-color: #88b1d4;
  color: #000000;
}
#T_4c737_row1_col1 {
  background-color: #b5c4df;
  color: #000000;
}
#T_4c737_row1_col3, #T_4c737_row1_col4, #T_4c737_row2_col3, #T_4c737_row2_col4 {
  background-color: #faf3f9;
  color: #000000;
}
#T_4c737_row2_col0, #T_4c737_row2_col2 {
  background-color: #3f93c2;
  color: #f1f1f1;
}
#T_4c737_row2_col1 {
  background-color: #67a4cc;
  color: #f1f1f1;
}
#T_4c737_row3_col0, #T_4c737_row3_col1, #T_4c737_row3_col2, #T_4c737_row5_col3, #T_4c737_row5_col4 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_4c737_row3_col3, #T_4c737_row3_col4, #T_4c737_row5_col0, #T_4c737_row5_col1, #T_4c737_row5_col2 {
  background-color: #fff7fb;
  color: #000000;
}
#T_4c737_row4_col0, #T_4c737_row4_col2 {
  background-color: #e5e1ef;
  color: #000000;
}
#T_4c737_row4_col1 {
  background-color: #e6e2ef;
  color: #000000;
}
#T_4c737_row4_col3, #T_4c737_row4_col4 {
  background-color: #046299;
  color: #f1f1f1;
}
#T_4c737_row6_col0, #T_4c737_row6_col2 {
  background-color: #ede8f3;
  color: #000000;
}
#T_4c737_row6_col3, #T_4c737_row6_col4 {
  background-color: #93b5d6;
  color: #000000;
}
</style>
<table id="T_4c737_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >0</th>
      <th class="col_heading level0 col1" >1</th>
      <th class="col_heading level0 col2" >2</th>
      <th class="col_heading level0 col3" >3</th>
      <th class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_4c737_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_4c737_row0_col0" class="data row0 col0" >0.97</td>
      <td id="T_4c737_row0_col1" class="data row0 col1" >1.15</td>
      <td id="T_4c737_row0_col2" class="data row0 col2" >0.83</td>
      <td id="T_4c737_row0_col3" class="data row0 col3" >-0.02</td>
      <td id="T_4c737_row0_col4" class="data row0 col4" >-0.02</td>
    </tr>
    <tr>
      <th id="T_4c737_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_4c737_row1_col0" class="data row1 col0" >1.94</td>
      <td id="T_4c737_row1_col1" class="data row1 col1" >2.33</td>
      <td id="T_4c737_row1_col2" class="data row1 col2" >1.66</td>
      <td id="T_4c737_row1_col3" class="data row1 col3" >0.08</td>
      <td id="T_4c737_row1_col4" class="data row1 col4" >0.08</td>
    </tr>
    <tr>
      <th id="T_4c737_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_4c737_row2_col0" class="data row2 col0" >2.78</td>
      <td id="T_4c737_row2_col1" class="data row2 col1" >3.32</td>
      <td id="T_4c737_row2_col2" class="data row2 col2" >2.37</td>
      <td id="T_4c737_row2_col3" class="data row2 col3" >0.08</td>
      <td id="T_4c737_row2_col4" class="data row2 col4" >0.08</td>
    </tr>
    <tr>
      <th id="T_4c737_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_4c737_row3_col0" class="data row3 col0" >4.85</td>
      <td id="T_4c737_row3_col1" class="data row3 col1" >5.74</td>
      <td id="T_4c737_row3_col2" class="data row3 col2" >4.14</td>
      <td id="T_4c737_row3_col3" class="data row3 col3" >-0.09</td>
      <td id="T_4c737_row3_col4" class="data row3 col4" >-0.09</td>
    </tr>
    <tr>
      <th id="T_4c737_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_4c737_row4_col0" class="data row4 col0" >0.40</td>
      <td id="T_4c737_row4_col1" class="data row4 col1" >1.42</td>
      <td id="T_4c737_row4_col2" class="data row4 col2" >0.33</td>
      <td id="T_4c737_row4_col3" class="data row4 col3" >4.07</td>
      <td id="T_4c737_row4_col4" class="data row4 col4" >4.07</td>
    </tr>
    <tr>
      <th id="T_4c737_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_4c737_row5_col0" class="data row5 col0" >-0.43</td>
      <td id="T_4c737_row5_col1" class="data row5 col1" >0.63</td>
      <td id="T_4c737_row5_col2" class="data row5 col2" >-0.38</td>
      <td id="T_4c737_row5_col3" class="data row5 col3" >4.93</td>
      <td id="T_4c737_row5_col4" class="data row5 col4" >4.93</td>
    </tr>
    <tr>
      <th id="T_4c737_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_4c737_row6_col0" class="data row6 col0" >0.20</td>
      <td id="T_4c737_row6_col1" class="data row6 col1" >0.71</td>
      <td id="T_4c737_row6_col2" class="data row6 col2" >0.17</td>
      <td id="T_4c737_row6_col3" class="data row6 col3" >2.03</td>
      <td id="T_4c737_row6_col4" class="data row6 col4" >2.03</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="movielense-dataset">
<h3>MovieLense dataset<a class="headerlink" href="#movielense-dataset" title="Link to this heading">#</a></h3>
<p>You can download dataset from here: https://grouplens.org/datasets/movielens/latest/</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !curl http://files.grouplens.org/datasets/movielens/ml-latest-small.zip --output ml-latest-small.zip</span>
<span class="c1"># !unzip ml-latest-small.zip</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ml-latest-small/ratings.csv&#39;</span><span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ml-latest-small/movies.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Limit to top movies so that we don&#39;t run out of memory</span>
<span class="n">n_movies</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">movie_idx_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;movieId&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n_movies</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)}</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">ratings</span><span class="o">.</span><span class="n">movieId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">movie_idx_map</span><span class="p">)]</span>

<span class="n">n_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;userId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">n_movies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;movieId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># Create matrix</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">))</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ratings</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">X</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">movie_idx_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)]]</span> <span class="o">=</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<p>Using SVD we will extract movie to concept similarities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">movies</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_idx_map</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>title</th>
      <th>Pay It Forward (2000)</th>
      <th>X-Men Origins: Wolverine (2009)</th>
      <th>Death Proof (2007)</th>
      <th>Virgin Suicides, The (1999)</th>
      <th>Lost Boys, The (1987)</th>
      <th>Bad Santa (2003)</th>
      <th>Rocky II (1979)</th>
      <th>About Schmidt (2002)</th>
      <th>21 Jump Street (2012)</th>
      <th>Buffy the Vampire Slayer (1992)</th>
      <th>...</th>
      <th>Schindler's List (1993)</th>
      <th>Terminator 2: Judgment Day (1991)</th>
      <th>Braveheart (1995)</th>
      <th>Jurassic Park (1993)</th>
      <th>Star Wars: Episode IV - A New Hope (1977)</th>
      <th>Matrix, The (1999)</th>
      <th>Silence of the Lambs, The (1991)</th>
      <th>Pulp Fiction (1994)</th>
      <th>Shawshank Redemption, The (1994)</th>
      <th>Forrest Gump (1994)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.013740</td>
      <td>-0.013834</td>
      <td>-0.014479</td>
      <td>-0.014837</td>
      <td>-0.015855</td>
      <td>-0.016608</td>
      <td>-0.015443</td>
      <td>-0.012657</td>
      <td>-0.013055</td>
      <td>-0.010631</td>
      <td>...</td>
      <td>-0.076227</td>
      <td>-0.081979</td>
      <td>-0.077771</td>
      <td>-0.080885</td>
      <td>-0.099899</td>
      <td>-0.105711</td>
      <td>-0.095243</td>
      <td>-0.107111</td>
      <td>-0.105981</td>
      <td>-0.109809</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.011250</td>
      <td>-0.024457</td>
      <td>-0.024160</td>
      <td>0.000844</td>
      <td>0.008939</td>
      <td>-0.009214</td>
      <td>0.001750</td>
      <td>0.004903</td>
      <td>-0.030972</td>
      <td>0.002863</td>
      <td>...</td>
      <td>0.048985</td>
      <td>0.078242</td>
      <td>0.095468</td>
      <td>0.092870</td>
      <td>0.023382</td>
      <td>-0.035287</td>
      <td>0.075200</td>
      <td>0.066094</td>
      <td>0.032788</td>
      <td>0.051767</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001458</td>
      <td>-0.007746</td>
      <td>-0.001571</td>
      <td>0.018164</td>
      <td>0.021655</td>
      <td>0.009750</td>
      <td>0.015829</td>
      <td>0.017258</td>
      <td>-0.011936</td>
      <td>0.007625</td>
      <td>...</td>
      <td>-0.052819</td>
      <td>-0.080936</td>
      <td>-0.131230</td>
      <td>-0.105519</td>
      <td>0.015748</td>
      <td>-0.002344</td>
      <td>-0.065713</td>
      <td>-0.083778</td>
      <td>-0.134976</td>
      <td>-0.150658</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.020321</td>
      <td>-0.012819</td>
      <td>-0.009553</td>
      <td>-0.007793</td>
      <td>-0.019447</td>
      <td>-0.020242</td>
      <td>-0.013159</td>
      <td>-0.014629</td>
      <td>-0.017410</td>
      <td>-0.023973</td>
      <td>...</td>
      <td>0.140400</td>
      <td>0.049982</td>
      <td>0.091585</td>
      <td>0.011390</td>
      <td>0.060125</td>
      <td>0.127014</td>
      <td>0.167883</td>
      <td>0.197865</td>
      <td>0.203880</td>
      <td>0.115254</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.023331</td>
      <td>0.018597</td>
      <td>0.008455</td>
      <td>-0.047220</td>
      <td>-0.004637</td>
      <td>-0.002883</td>
      <td>0.008537</td>
      <td>-0.013256</td>
      <td>-0.000489</td>
      <td>-0.002727</td>
      <td>...</td>
      <td>-0.072136</td>
      <td>0.125815</td>
      <td>0.055847</td>
      <td>0.051397</td>
      <td>0.139230</td>
      <td>0.105409</td>
      <td>-0.021655</td>
      <td>-0.049932</td>
      <td>-0.072611</td>
      <td>-0.044770</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.018199</td>
      <td>0.036357</td>
      <td>0.043401</td>
      <td>0.001917</td>
      <td>0.012641</td>
      <td>0.043390</td>
      <td>0.033525</td>
      <td>0.009536</td>
      <td>0.038427</td>
      <td>0.014844</td>
      <td>...</td>
      <td>-0.060634</td>
      <td>-0.007255</td>
      <td>-0.010162</td>
      <td>-0.021724</td>
      <td>-0.104246</td>
      <td>-0.158481</td>
      <td>0.006284</td>
      <td>0.027659</td>
      <td>-0.048065</td>
      <td>-0.075252</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.001026</td>
      <td>-0.011047</td>
      <td>0.005113</td>
      <td>0.009880</td>
      <td>0.017532</td>
      <td>0.023910</td>
      <td>-0.020644</td>
      <td>0.004396</td>
      <td>-0.027700</td>
      <td>0.005198</td>
      <td>...</td>
      <td>-0.037308</td>
      <td>0.009797</td>
      <td>0.045087</td>
      <td>-0.020993</td>
      <td>-0.095660</td>
      <td>0.016492</td>
      <td>-0.034036</td>
      <td>0.048123</td>
      <td>-0.014165</td>
      <td>-0.047230</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.003380</td>
      <td>0.008470</td>
      <td>-0.000499</td>
      <td>0.020740</td>
      <td>-0.012323</td>
      <td>-0.002078</td>
      <td>-0.004215</td>
      <td>0.026335</td>
      <td>-0.042955</td>
      <td>-0.007411</td>
      <td>...</td>
      <td>-0.032278</td>
      <td>0.038842</td>
      <td>-0.010127</td>
      <td>0.004377</td>
      <td>-0.011656</td>
      <td>-0.045959</td>
      <td>-0.038364</td>
      <td>-0.037230</td>
      <td>-0.065388</td>
      <td>-0.107479</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.034645</td>
      <td>-0.006897</td>
      <td>-0.000399</td>
      <td>-0.019876</td>
      <td>0.012274</td>
      <td>0.003739</td>
      <td>-0.008065</td>
      <td>-0.018824</td>
      <td>0.024425</td>
      <td>0.005707</td>
      <td>...</td>
      <td>-0.104706</td>
      <td>0.029340</td>
      <td>-0.022012</td>
      <td>0.042776</td>
      <td>0.051743</td>
      <td>0.032488</td>
      <td>0.017145</td>
      <td>0.089404</td>
      <td>0.002659</td>
      <td>0.003673</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.015903</td>
      <td>-0.000305</td>
      <td>0.005696</td>
      <td>0.043266</td>
      <td>0.012414</td>
      <td>-0.025808</td>
      <td>-0.003037</td>
      <td>-0.007873</td>
      <td>0.030505</td>
      <td>0.010252</td>
      <td>...</td>
      <td>0.023747</td>
      <td>0.014477</td>
      <td>0.053049</td>
      <td>-0.039673</td>
      <td>-0.068472</td>
      <td>0.119593</td>
      <td>0.020346</td>
      <td>0.000522</td>
      <td>-0.055144</td>
      <td>0.070372</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.001406</td>
      <td>-0.005298</td>
      <td>0.008760</td>
      <td>-0.017152</td>
      <td>0.023984</td>
      <td>0.002957</td>
      <td>0.023398</td>
      <td>-0.003396</td>
      <td>-0.028628</td>
      <td>0.008408</td>
      <td>...</td>
      <td>0.073421</td>
      <td>0.051356</td>
      <td>0.043076</td>
      <td>0.075722</td>
      <td>-0.150913</td>
      <td>-0.007862</td>
      <td>0.075812</td>
      <td>0.016360</td>
      <td>-0.014274</td>
      <td>0.058397</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-0.012716</td>
      <td>0.004792</td>
      <td>-0.004085</td>
      <td>-0.017034</td>
      <td>-0.006017</td>
      <td>-0.012858</td>
      <td>-0.005998</td>
      <td>0.020699</td>
      <td>0.010918</td>
      <td>-0.011023</td>
      <td>...</td>
      <td>-0.103410</td>
      <td>0.036463</td>
      <td>0.013066</td>
      <td>0.045016</td>
      <td>-0.117291</td>
      <td>-0.025093</td>
      <td>-0.035659</td>
      <td>-0.004290</td>
      <td>0.023100</td>
      <td>0.065313</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.005869</td>
      <td>0.003650</td>
      <td>-0.018529</td>
      <td>0.011077</td>
      <td>0.043176</td>
      <td>-0.007125</td>
      <td>0.034755</td>
      <td>0.027206</td>
      <td>-0.027423</td>
      <td>0.021144</td>
      <td>...</td>
      <td>0.056853</td>
      <td>-0.016323</td>
      <td>0.031125</td>
      <td>-0.072646</td>
      <td>0.001670</td>
      <td>0.032127</td>
      <td>-0.013684</td>
      <td>-0.056567</td>
      <td>0.064341</td>
      <td>0.007135</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.005996</td>
      <td>0.002491</td>
      <td>0.031717</td>
      <td>0.011993</td>
      <td>0.009330</td>
      <td>-0.035608</td>
      <td>-0.018394</td>
      <td>-0.009139</td>
      <td>0.028074</td>
      <td>-0.018422</td>
      <td>...</td>
      <td>-0.049781</td>
      <td>0.116128</td>
      <td>-0.010845</td>
      <td>0.097686</td>
      <td>0.010207</td>
      <td>-0.063918</td>
      <td>-0.007434</td>
      <td>-0.061586</td>
      <td>-0.121899</td>
      <td>0.015993</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.012578</td>
      <td>-0.013483</td>
      <td>-0.013961</td>
      <td>0.032025</td>
      <td>0.004451</td>
      <td>-0.006539</td>
      <td>0.009263</td>
      <td>-0.027288</td>
      <td>-0.005632</td>
      <td>0.006778</td>
      <td>...</td>
      <td>-0.104836</td>
      <td>0.010010</td>
      <td>0.052742</td>
      <td>-0.036469</td>
      <td>0.031710</td>
      <td>-0.062999</td>
      <td>-0.044498</td>
      <td>0.048006</td>
      <td>-0.126826</td>
      <td>-0.097512</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.022066</td>
      <td>0.011581</td>
      <td>0.008359</td>
      <td>0.021246</td>
      <td>0.049890</td>
      <td>0.026701</td>
      <td>-0.019088</td>
      <td>0.028568</td>
      <td>0.017048</td>
      <td>0.003622</td>
      <td>...</td>
      <td>0.116622</td>
      <td>0.023241</td>
      <td>0.036634</td>
      <td>0.007887</td>
      <td>-0.001071</td>
      <td>0.030090</td>
      <td>0.133939</td>
      <td>-0.014331</td>
      <td>0.122462</td>
      <td>-0.021362</td>
    </tr>
    <tr>
      <th>16</th>
      <td>-0.038829</td>
      <td>0.020619</td>
      <td>-0.002479</td>
      <td>-0.020015</td>
      <td>-0.026402</td>
      <td>-0.008829</td>
      <td>0.025848</td>
      <td>0.012024</td>
      <td>-0.003265</td>
      <td>-0.016658</td>
      <td>...</td>
      <td>-0.063076</td>
      <td>-0.071958</td>
      <td>-0.090464</td>
      <td>-0.019738</td>
      <td>-0.161150</td>
      <td>-0.111749</td>
      <td>-0.083454</td>
      <td>-0.047222</td>
      <td>-0.108038</td>
      <td>-0.010785</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-0.000813</td>
      <td>0.012850</td>
      <td>-0.006854</td>
      <td>0.039239</td>
      <td>-0.003861</td>
      <td>-0.031964</td>
      <td>-0.001517</td>
      <td>-0.026608</td>
      <td>-0.017589</td>
      <td>0.012412</td>
      <td>...</td>
      <td>-0.070014</td>
      <td>-0.051948</td>
      <td>-0.056400</td>
      <td>-0.053108</td>
      <td>-0.037174</td>
      <td>0.006092</td>
      <td>-0.032793</td>
      <td>-0.002472</td>
      <td>-0.074182</td>
      <td>-0.121479</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.001690</td>
      <td>0.025183</td>
      <td>-0.003327</td>
      <td>0.006692</td>
      <td>0.009529</td>
      <td>-0.011259</td>
      <td>0.006495</td>
      <td>-0.008801</td>
      <td>-0.015817</td>
      <td>0.005609</td>
      <td>...</td>
      <td>0.007602</td>
      <td>-0.040582</td>
      <td>-0.062397</td>
      <td>-0.064944</td>
      <td>-0.074414</td>
      <td>-0.051338</td>
      <td>0.116508</td>
      <td>0.031266</td>
      <td>0.054048</td>
      <td>-0.033933</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-0.018182</td>
      <td>0.028629</td>
      <td>-0.016610</td>
      <td>0.009220</td>
      <td>-0.019316</td>
      <td>-0.022267</td>
      <td>0.018684</td>
      <td>-0.002331</td>
      <td>0.007455</td>
      <td>-0.009498</td>
      <td>...</td>
      <td>0.151109</td>
      <td>-0.061828</td>
      <td>0.042816</td>
      <td>0.049376</td>
      <td>0.040697</td>
      <td>0.008625</td>
      <td>0.050223</td>
      <td>0.085286</td>
      <td>-0.016505</td>
      <td>0.015445</td>
    </tr>
  </tbody>
</table>
<p>20 rows × 1000 columns</p>
</div></div></div>
</div>
<p>Now using any distance measure we can try to extract similar movies directly from V!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Toy Story (1995)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>title
Toy Story (1995)                              0.000000
Toy Story 2 (1999)                            0.002411
Nutty Professor, The (1996)                   0.002757
Twister (1996)                                0.002821
Willy Wonka &amp; the Chocolate Factory (1971)    0.002958
Hunchback of Notre Dame, The (1996)           0.003167
Bug&#39;s Life, A (1998)                          0.003306
Multiplicity (1996)                           0.003310
Dragonheart (1996)                            0.003376
Rumble in the Bronx (Hont faan kui) (1995)    0.003380
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Matrix, The (1999)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>title
Matrix, The (1999)                                           0.000000
Fight Club (1999)                                            0.003215
Saving Private Ryan (1998)                                   0.003370
Gladiator (2000)                                             0.003589
Star Wars: Episode I - The Phantom Menace (1999)             0.003986
Star Wars: Episode V - The Empire Strikes Back (1980)        0.004086
Lord of the Rings: The Fellowship of the Ring, The (2001)    0.004136
Payback (1999)                                               0.004558
Memento (2000)                                               0.004605
Intouchables (2011)                                          0.004631
dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>TASK:</strong> naively in the recommender examples above we have not done any preprocessing. Actually it would be beneficial to remove movie bias by calculating average rating per movie, and subtracting this average from each user/movie pair. Try to add such a fix and see if that improves results. For evaluation you will need to make a train and test split.</p>
</section>
</section>
<section id="naive-svd-implementation">
<h2>Naive SVD implementation<a class="headerlink" href="#naive-svd-implementation" title="Link to this heading">#</a></h2>
<p><strong>TASK:</strong> can you think of a simple algorithm that computes SVD? Think about that before reading on.</p>
<p>We know that matrix multiplication stetches and rotates the space. Try to image that you take any vector in space and repeatedly multiply it by the matrix. After some iterations this vector will align with rotation axis. Make sure you understood the claim before jumping into implementation.</p>
<p>One caviat is that this vector will get really long and as we know big numbers are computationaly unstable, thus we will simply normalize the vector each time. This trick is called <em>power itearation</em> and can be expressed as:</p>
<p>$$b_{k+1} = \frac{Ab_k}{||Ab_k||}.$$</p>
<p>Let’s start with random matrix and compute svd using numpy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note, that we can drop some rows/columns without loosing any valuable information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">:</span><span class="n">k</span><span class="p">]</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">V</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">U</span> <span class="o">*</span> <span class="n">S</span> <span class="o">@</span> <span class="n">V</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finding the first singular value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span> <span class="o">@</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span> <span class="o">@</span> <span class="n">v</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span> <span class="o">@</span> <span class="n">v</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Note, that sign of the vector can be flipped</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>TASK:</strong> improve run time by refactoring <code class="docutils literal notranslate"><span class="pre">A.T</span> <span class="pre">&#64;</span> <span class="pre">A</span></code> and repeating loop only until value of <code class="docutils literal notranslate"><span class="pre">v</span></code> becomes stable.</p>
<p>Also we can extract u as follows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">v</span> <span class="o">/</span> <span class="n">s</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we just need to repeat this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<span class="n">S_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="n">V_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

<span class="c1"># We will modify matrix, thus let&#39;s copy it first</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
    <span class="n">B_temp</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">B</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">B_temp</span> <span class="o">@</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">B_temp</span> <span class="o">@</span> <span class="n">v</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">B</span> <span class="o">@</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">B</span> <span class="o">@</span> <span class="n">v</span> <span class="o">/</span> <span class="n">s</span>     
    
    <span class="n">V_approx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">S_approx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
    <span class="n">U_approx</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

    <span class="c1"># Trick is to modify original matrix by subtacting dominating component</span>
    <span class="n">B</span> <span class="o">-=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s check our result</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">S_approx</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">V_approx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U_approx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">71</span><span class="o">/</span><span class="mi">2</span><span class="n">t6j6ytn1t3dfp5dxb9zhh6w0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_2065</span><span class="o">/</span><span class="mf">2408988766.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">S_approx</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">V_approx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U_approx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>

<span class="ne">AssertionError</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[-0.61901597,  0.44510372,  0.51126632],
        [-0.6740068 , -0.37554582, -0.61507256],
        [ 0.09478835,  0.80135527, -0.59054837],
        [ 0.39185358, -0.13666653, -0.10744823]]),
 array([2.66995443, 1.80851629, 0.48198335]),
 array([[ 0.6880199 ,  0.06596949, -0.7226871 ],
        [ 0.71887595,  0.07421067,  0.69116579],
        [-0.09922694,  0.99505819, -0.00363454]]))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U_approx</span><span class="p">,</span> <span class="n">S_approx</span><span class="p">,</span> <span class="n">V_approx</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[ 0.61837371,  0.44704634, -0.51126632],
        [ 0.67454745, -0.37342639,  0.61507256],
        [-0.0959434 ,  0.80105351,  0.59054837],
        [-0.39165617, -0.13789698,  0.10744823]]),
 array([2.66995115, 1.80852112, 0.48198335]),
 array([[-0.68954819, -0.06612726,  0.72121458],
        [ 0.71741013,  0.07407011,  0.69270219],
        [ 0.09922694, -0.99505819,  0.00363454]]))
</pre></div>
</div>
</div>
</div>
<p>For sure there are much better algorithms to compute SVD, but I hope this naive implementation provides some intuition of why SVD and eigenvectors work the way they do.</p>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h2>
<p>I hope that all these examples illustrate how a relatively simple principle can have far reaching applications. Most importantly this shows that linear algebra is powerful tool and matrices hold the power to do impressive things. We will see later that neural networks are built from these concepts.</p>
</section>
<section id="re-sources">
<h2>(re)Sources<a class="headerlink" href="#re-sources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://medium.com/&#64;jonathan_hui/machine-learning-singular-value-decomposition-svd-principal-component-analysis-pca-1d45e885e491">SVD math basics</a> or the <a class="reference external" href="https://towardsdatascience.com/understanding-singular-value-decomposition-and-its-application-in-data-science-388a54be95d">extended</a> version.</p></li>
<li><p><a class="reference external" href="https://www.rose-hulman.edu/~bryan/googleFinalVersionFixed.pdf">Paper - THE $25,000,000,000∗ EIGENVECTOR THE LINEAR ALGEBRA BEHIND GOOGLE</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/Qz58vTa8-SY">Video - A primer (or refresher) on linear algebra</a></p></li>
<li><p><a class="reference external" href="https://slideplayer.com/slide/5283216/">Slides - Dimensionality Reduction PCA – SVD</a></p></li>
<li><p><a class="reference external" href="https://hackernoon.com/introduction-to-recommender-system-part-1-collaborative-filtering-singular-value-decomposition-44c9659c5e75">Blog - Introduction to Recommender System. Part 1 (Collaborative Filtering, Singular Value Decomposition)</a></p></li>
<li><p><a class="reference external" href="http://fourier.eng.hmc.edu/e161/lectures/svdcompression.html">Blog - Image Compression with SVD</a></p></li>
<li><p>Naive SVD algorithm was inspired by <a class="reference external" href="https://towardsdatascience.com/simple-svd-algorithms-13291ad2eef2#:~:text=General%20formula%20of%20SVD%20is,columns%20are%20left%20singular%20vectors">blog post</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Power_iteration">wiki</a></p></li>
</ul>
<p>For more SVD use-case examples see:</p>
<ul class="simple">
<li><p><em>Data-Driven Science and Engineering: Machine Learning, Dynamical Systems, and Control</em> by J. Nathan Kutz and Steven L. Brunton.</p></li>
<li><p>Fast AI <a class="reference external" href="https://www.fast.ai/2017/07/17/num-lin-alg/">Computational Linear Algebra course</a> contains <a class="reference external" href="https://nbviewer.org/github/fastai/numerical-linear-algebra/blob/master/nbs/3.%20Background%20Removal%20with%20Robust%20PCA.ipynb">background removal example</a>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Welcome to AI primer course</p>
      </div>
    </a>
    <a class="right-next"
       href="RF.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">RF (Random Forest)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#increasing-importance-of-linear-algebra">Increasing importance of linear algebra</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-algebra-missing-pieces">Linear algebra (missing pieces?)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-vector-multiplication">Matrix-vector multiplication</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eigenvectors">Eigenvectors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-calculate-eigenvectors">How to calculate eigenvectors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#singular-value-decomposition-svd">Singular Value Decomposition (SVD)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-is-svd-computed">How is SVD computed?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-svd-to-compress-images">Using SVD to compress images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svd-for-linear-regression">SVD for linear regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-principal-component-analysis">PCA (Principal Component analysis)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommender-using-svd">Recommender using SVD</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplest-recommender">Simplest recommender</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#movielense-dataset">MovieLense dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-svd-implementation">Naive SVD implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-sources">(re)Sources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By trokas
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright MIF, 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>